
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Zero Waste Games</title>
    <style>
      * {
        padding: 0;
        margin: 0;
      }
      canvas {
        background: #ffffff;
        display: block;
        margin: 0 auto;
        border:none;
      }

      #volumeBox {
        position: fixed;
        /* padding: 30px; */
        top: 30px;
        right: 330px;
        z-index: 9999;
      }


      #volumeSlider {
        width: 150px;
        accent-color: lime;
        opacity: 0;                      /* hidden by default */
        transition: opacity 0.2s ease-in-out;
        pointer-events: none;            
      }

      #volumeBox:hover #volumeSlider {
        opacity: 1;                      /* fades in on hover */
        pointer-events: auto;            
      }
      #volumeBox::before {
        content: "";
        position: absolute;
        top: 0;
        left: -110px;               /* extend hover area 60px to the left */
        width: 100px;               /* how wide the extra hover area is */
        height: 200%;
        background: transparent;   /* invisible, but still triggers hover */
      }
      html, body {
        background-color: black;
        color:white;
        margin:0;
        padding:0;
        height:100%;
        overflow:hidden;
      }
      #helpCanvas{
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Vision template max width is 653px (translates to 435px height) -->
    <!-- Original is 960px width and 640px height -->
    <canvas id="myCanvas" width="960" height="640"></canvas>
    <canvas id="helpCanvas" width="300" height="640"
        style="background:black; color:white; position:absolute; right:0; top:0; display:none;">
    </canvas>
    <div id="altText" aria-live="polite"></div>

      <!--  Volume Slider  -->  
      <div id="volumeBox">
        <input type="range" id="volumeSlider" min="0" max="100" value="60" step="1">
      </div>

      <div id="pauseVolumeBox" style="display:none;">
        <input type="range" id="pauseVolumeSlider" min="0" max="100" value="60" step="1">
      </div>


    <script src="Classes/Tile.js"></script>
    <script src="Classes/Timer.js"></script>
    <script src="Classes/CircularButton.js"></script>
    <script src="Classes/RectangularButton.js"></script>
    <script src="Classes/Garbage.js"></script>

    <script>

      var paperBinX = 0;
      var comingledBinX = binWidth;
      var organicsBinX = binWidth * 2;
      var landfillBinX = binWidth * 3;

      var selectedGarbageItem = null;
      var selectedGarbageIndex = 0; //Track garbage item for cycling
      var selectedSortableIndex = -1;
      let manualSwitching = false; 
      let selectionLocked = false;
      let settingsMenuOpen = false;
      var helpButtonImg = new Image();

      


      //Keyboard event handlers
      let keys =[];
      let previousVolume = 0.6;
      let isMuted = false;
      let showMuteButton = true;
      let keyboardNavigationActive = false; // Flag to track if keyboard navigation is active
      document.addEventListener('keydown', (e) => {
        keys[e.key] = true;

          const k = e.key.toLowerCase();

          if (k === "backspace"){
            if (currentState === state.PLAYMATCH || currentState === state.PLAYSORT) {
              return; 
          }

            if (!muted) {
                buttonSound.load();
                buttonSound.play();
            }

            // Handle back navigation
            switch (currentState) {
                case state.WELCOME1:
                    currentState = state.MAININTRO;
                    updateAltText("Back to main intro.");
                    break;

                case state.WELCOME2:
                    currentState = state.WELCOME1;
                    updateAltText("Back.");
                    break;

                case state.CHOOSEGAME:
                    currentState = state.WELCOME2;
                    updateAltText("Back.");
                    break;

                case state.MATCHINTRO1:
                    currentState = state.CHOOSEGAME;
                    updateAltText("Back.");
                    break;

                case state.MATCHINTRO2:
                    currentState = state.MATCHINTRO1;
                    updateAltText("Back.");
                    break;

                case state.MATCHINTRO3:
                    currentState = state.MATCHINTRO2;
                    updateAltText("Back.");
                    break;

                case state.MATCHLEVEL:
                    currentState = state.MATCHINTRO3;
                    updateAltText("Back to Matching instructions.");
                    break;

                case state.SORTINTRO1:
                    currentState = state.CHOOSEGAME;
                    updateAltText("Back.");
                    break;

                case state.SORTINTRO2:
                    currentState = state.SORTINTRO1;
                    updateAltText("Back.");
                    break;

                case state.SORTLEVEL:
                    currentState = state.SORTINTRO2;
                    updateAltText("Back to Sorting instructions.");
                    break;
            }

            return;
        }

        //LEVEL SELECT HOTKEYS
        if (["1", "2", "3"].includes(k)) {
            
            // Matching Level Screen
            if (currentState === state.MATCHLEVEL) {
                level = Number(k);
                setMatchLevelBoard();
                if (!muted) {
                    backgroundMusic.pause();
                    matchingMusic.currentTime = 0;
                    matchingMusic.play();
                }
                timer.setTimerTime(timerTime);
                timer.start();
                currentState = state.PLAYMATCH;
                updateAltText(`Matching level ${level} started.`);
                return;
            }

            // Sorting Level Screen
            if (currentState === state.SORTLEVEL) {
                level = Number(k);
                setSortLevelBoard();
                if (!muted) {
                    backgroundMusic.pause();
                    sortingMusic.currentTime = 0;
                    sortingMusic.play();
                }
                timer.setTimerTime(timerTime);
                timer.start();
                currentState = state.PLAYSORT;
                updateAltText(`Sorting level ${level} started.`);
                return;
            }

        }

          // Toggle mute with "m"
        if (k === 'm') {
          muted = !muted;

          if (muted) {
            previousVolume = Number(volumeSlider.value)/100;
            backgroundMusic.pause();
            matchingMusic.pause();
            sortingMusic.pause();

            // Set all volumes to 0
            backgroundMusic.volume = 0;
            matchingMusic.volume = 0;
            sortingMusic.volume = 0;
            buttonSound.volume = 0;
            tileFlipSound.volume = 0;
            tileMatchSound.volume = 0;

            // Reflect mute on sliders
            volumeSlider.value = 0;
            pauseVolumeSlider.value = 0;
            isMuted = true;
            updateAltText("Sound muted.");
          } else {
            // Restore all volumes
            backgroundMusic.volume = previousVolume;
            matchingMusic.volume = previousVolume;
            sortingMusic.volume = previousVolume;
            buttonSound.volume = previousVolume;
            tileFlipSound.volume = previousVolume;
            tileMatchSound.volume = previousVolume;
            // resume the correct track for the current state
            if (currentState === state.PLAYMATCH) {
              matchingMusic.currentTime ||= 0;
              matchingMusic.play();
            } else if (currentState === state.PLAYSORT) {
              sortingMusic.currentTime ||= 0;
              sortingMusic.play();
            } else {
              backgroundMusic.currentTime ||= 0;
              backgroundMusic.play();
            }

            volumeSlider.value = previousVolume * 100;
            pauseVolumeSlider.value = previousVolume * 100;
            isMuted = false;
            updateAltText("Sound unmuted.");
          }
          return; 
        }

      // Toggle pause with "p" 
      if (k === 'p') {
        if (currentState === state.PLAYMATCH || currentState === state.PLAYSORT) {
          // ignore during match/end delay screens
          if (!timer.isMatchDelayed?.() && !timer.isEndDelayed?.()) {
            if (!timer.isPaused()) {
              timer.pause();
              document.getElementById("pauseVolumeBox").style.display = "block";
              if (typeof pauseButton !== "undefined"){ 
                pauseButton.image = playButtonImg;
                pauseButton.x = canvas.width / 2 - originalPlayButtonSize * 2 - originalPlayButtonSize / 4;
                pauseButton.y = canvas.height / 2 - originalPlayButtonSize / 2 - originalPlayButtonSize / 8;
                pauseButton.size = originalPlayButtonSize;
              }
              updateAltText("Game paused.");
            } else {
              timer.unpause();
              document.getElementById("pauseVolumeBox").style.display = "none";
              if (typeof pauseButton !== "undefined"){
                pauseButton.image = pauseButtonImg;
                pauseButton.x = canvas.width - originalPlayButtonSize * 2;
                pauseButton.y = canvas.height - originalPlayButtonSize - 15;
                pauseButton.size = originalPlayButtonSize;
              } 
              updateAltText("Game resumed.");
            }
          }
        }
        return;
      }

      if (k === 'h'){
        if (!muted) {
          buttonSound.load();
          buttonSound.play();
      }
      toggleHelpMenu();
      return;
      }

      
    
      if(timer.isPaused()){
        const pauseVolumeSlider = document.getElementById("pauseVolumeSlider");
        let v = Number(pauseVolumeSlider.value);

        //Resume Game with enter key
        if(k === 'enter'){
          timer.unpause();
          document.getElementById("pauseVolumeBox").style.display="none";

          if(typeof pauseButton!=="undefined"){
            pauseButton.image = pauseButtonImg;
            pauseButton.x = canvas.width - originalPlayButtonSize *2;
            pauseButon.y = canvas.height - originalPlayButtonSize -15;
            pauseButton.size = originalPlayButtonSize;
          }
          updateAltText("Game resumed");
          return;
        }

        //r key to restart game
        if(k ==='r'){
          document.getElementById("pauseVolumeBox").style.display = "none";
          hideMuteIcon();
          //ocument.getElementById("volumeBox").style.display = "none";
          showMuteButton = false;
          timer.unpause();

          if (currentState === state.PLAYMATCH) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
              matchingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
          }
            currentState = state.MATCHLEVEL;
        } else if (currentState === state.PLAYSORT) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
              sortingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
            }
            currentState = state.SORTLEVEL;
           }
          timer.setTimerTime(timerTime);
          timer.start();
          updateAltText("Game restarted.");
          return;
      }

      // Escape key to main menu
      if (k === 'escape') {
        timer.unpause();
        document.getElementById("pauseVolumeBox").style.display = "none";
        hideMuteIcon();
        const volumeBox = document.getElementById("volumeBox");
        if (volumeBox){ 
          volumeBox.style.display = "none";
        }
        showMuteButton = false;

        if (typeof pauseButton !== "undefined") {
          pauseButton.image = pauseButtonImg;
          pauseButton.x = canvas.width - originalPlayButtonSize * 2;
          pauseButton.y = canvas.height - originalPlayButtonSize - 15;
          pauseButton.size = originalPlayButtonSize;
        }
        if (!muted) {
          buttonSound.load();
          buttonSound.play();
          sortingMusic.pause();
          matchingMusic.pause();
          backgroundMusic.currentTime = 0;
          backgroundMusic.play();
        }
        currentState = state.MAININTRO;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        updateAltText("Returned to Main Menu.");
        return;
  }

    // Adjust volume with arrows keys
    if (k === 'arrowleft') {
      v = Math.max(0, v - 5);
      pauseVolumeSlider.value = v;
    } else if (k === 'arrowright') {
      v = Math.min(100, v + 5);
      pauseVolumeSlider.value = v;
    }

    const volumeValue = v / 100;
    backgroundMusic.volume = volumeValue;
    matchingMusic.volume = volumeValue;
    sortingMusic.volume = volumeValue;
    buttonSound.volume = volumeValue;
    tileFlipSound.volume = volumeValue;
    tileMatchSound.volume = volumeValue;

    volumeSlider.value = pauseVolumeSlider.value;
    e.preventDefault();
    return;
  }

if (k === 't') {
  timerFreeze = !timerFreeze;
  if (timerFreeze) {
    tFreezeStart = Date.now();
    updateAltText("Timer frozen.");
  } else {
    tFrozenAccum += Date.now() - tFreezeStart;
    tFreezeStart = 0;
    updateAltText("Timer resumed.");
  }
  return;
}




        if (currentState === state.PLAYMATCH){
          if(timer.isMatchDelayed()){
            timer.endMatchDelay();
            timer.update();
            numberTilesFlipped = 0;
            return;
          }
        }

        if (currentState === state.PLAYMATCH && !timer.isPaused() && !timer.isMatchDelayed() && !timer.isEndDelayed()){
          keyboardNavigationActive = true;

          // Initialize selectedTileIndex if not already set
          if (selectedTileIndex === -1){
            selectedTileIndex = 0;
          }

          let moved = false;

          if (e.key === "ArrowUp"){
            e.preventDefault(); // Prevent default scrolling behavior
            if(selectedTileIndex % tileRowCount !== 0){
              selectedTileIndex--;
              moved = true;
            }
            updateAltText(`Moved to card ${selectedTileIndex + 1}. ${getTileDescription(selectedTileIndex)}`);
          }

          if (e.key === "ArrowDown"){
            e.preventDefault();
            if ((selectedTileIndex + 1) % tileRowCount !==0 && selectedTileIndex<tiles.length-1){
              selectedTileIndex++;
              moved = true;
            }
            updateAltText(`Moved to card ${selectedTileIndex + 1}. ${getTileDescription(selectedTileIndex)}`);
          }

          if (e.key === "ArrowLeft"){
            e.preventDefault();
            if(selectedTileIndex - tileRowCount>=0){
              selectedTileIndex -= tileRowCount;
              moved = true;
            }
            updateAltText(`Moved to card ${selectedTileIndex + 1}. ${getTileDescription(selectedTileIndex)}`);
          }

          if (e.key === "ArrowRight"){
            e.preventDefault();
            if (selectedTileIndex + tileRowCount < tiles.length){
              selectedTileIndex += tileRowCount;
              moved = true;
            }
            updateAltText(`Moved to card ${selectedTileIndex + 1}. ${getTileDescription(selectedTileIndex)}`);
          }

          if ((e.key === " " || e.key === "Enter") && selectedTileIndex >= 0){
            e.preventDefault();
            if (!tiles[selectedTileIndex].flipped && !tiles[selectedTileIndex].matched && numberTilesFlipped < 2){
              tiles[selectedTileIndex].flipped = true;
            
              if(numberTilesFlipped === 1){
                secondFlippedTileIndex = selectedTileIndex;
              } else {
                if(!muted){
                  tileFlipSound.load();
                  tileFlipSound.play();
                }
                firstFlippedTileIndex = selectedTileIndex;
              }
              numberTilesFlipped++;
              
              if (numberTilesFlipped === 2){
                if (tiles[firstFlippedTileIndex].image === tiles[secondFlippedTileIndex].image){
                  handleMatch(firstFlippedTileIndex);
                } else {
                  updateAltText(`You tried matching ${tiles[firstFlippedTileIndex].image.alt} and ${tiles[secondFlippedTileIndex].image.alt}`);
                  if (!muted){
                    tileFlipSound.load();
                    tileFlipSound.play();
                  }
                  timer.missDelay();
                }
                } else {
                  updateAltText(`Flipped card ${selectedTileIndex + 1}: ${tiles[selectedTileIndex].image.alt}`);
                }
              }
          }
        } else if (currentState == state.MAININTRO) {
          updateAltText("Professor Davis Green. Goes Zero Waste.")
          if (e.key == "Enter") {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }
            currentState = state.WELCOME1;
            updateAltText("Hi friends! I'm Professor Davis Green. Keeping waste out of landfills by recycling and composting is important.")
          }
        } else if(currentState == state.WELCOME1) {
          if (e.key == "Enter") {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }
            currentState = state.WELCOME2;
            updateAltText("I need your help. Will you help me divert waste from the landfill.")
          }
        } else if(currentState == state.WELCOME2) {
          if (e.key == "Enter") {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }
            currentState = state.CHOOSEGAME;
            updateAltText("Play both games to learn more about keeping waste out of landfill. Can select Zero Waste Matching and Zero Waste Sorting.") 
          }
        } else if(currentState == state.CHOOSEGAME) {
            if(e.key === "1" || e.key == "2") {
              if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
              } 
              if(e.key === "1"){
                currentState = state.MATCHINTRO1;
                updateAltText("Recology Davis picks up all the trash, recycling, and organics from Davis.");
            }  else if (e.key === "2"){
               currentState = state.SORTINTRO1;
               updateAltText("In Davis we sort waste into 4 seperate bins.");
            }
          }
        } else if (currentState == state.SORTINTRO1) {
          if(e.key == "Enter") {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }
            currentState = state.SORTINTRO2;
            updateAltText("Sort the falling waste into the correct bin. See how much waste you can keep out of the landfill.");
          }
        
        } else if (currentState === state.MATCHINTRO1){
            if(e.key === "Enter"){
              if(!muted){
                backgroundMusic.play();
                buttonSound.load();
                buttonSound.play();
              }
              currentState = state.MATCHINTRO2;
              updateAltText("Recyclables are brought to the recycling center in Davis. Organics are sent to the composting facility at the Yolo County landfill. Trash is buried in the Yolo County landfill.");
          }
        } else if (currentState === state.MATCHINTRO2) {
            if (e.key === "Enter") {
             if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }
            currentState = state.MATCHINTRO3;
            updateAltText("Click on two cards to find a match and learn which materials can be recycled and composted.");
          }
        } else if (currentState === state.MATCHINTRO3) {
            if (e.key === "Enter") {
              if (!muted) {
                backgroundMusic.play();
                buttonSound.load();
                buttonSound.play();
              }
              currentState = state.MATCHLEVEL;
              updateAltText("Choose a level to start the game!");
          }
        } else if(currentState == state.SORTINTRO2) {
          if(e.key == "Enter") {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }
            currentState = state.SORTLEVEL;
            updateAltText("Select a level to start the game!");
          }
        } else if(currentState == state.SORTLEVEL) {
          if (e.key == "1") {
              level = 1;
            } else if (e.key == "2") {
              level = 2;
            } else if (e.key == "3") {
              level = 3;
            }
            
            if(["1","2","3"].includes(e.key)){
              setSortLevelBoard();
              currentState = state.PLAYSORT;

              updateAltText("4 recycling bins at the bottom of the screen in the order of Paper, Plastic Glass and Metal, Organics, and Landfill");
          
            pauseButton.image = pauseButtonImg;
            pauseButton.x = sidebarLocalXOrigin + binWidth * (1 / 8);
            pauseButton.y = canvas.height * (7 / 16);
            pauseButton.size = sortButtonSize;

            muteButton.x = sidebarLocalXOrigin + binWidth * (9 / 16);
            muteButton.y = canvas.height * (7 / 16);
            muteButton.size = sortButtonSize;

            homeButton.x =
              canvas.width / 2 - originalPlayButtonSize * 2 - originalPlayButtonSize / 4;
            homeButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            homeButton.size = originalPlayButtonSize;

            restartButton.x =
              canvas.width / 2 - originalPlayButtonSize + originalPlayButtonSize / 8;
            restartButton.y =
              canvas.height / 2 - originalPlayButtonSize / 2 - originalPlayButtonSize / 8;
            restartButton.size = originalPlayButtonSize;

            if (!muted) {
              backgroundMusic.pause();
              sortingMusic.currentTime = 0;
              sortingMusic.play();
            }

            timer.setTimerTime(timerTime);
            timer.start();
            toggleAudio(x, y);
            } 
        }  
          else if (currentState == state.PLAYSORT) {
              // Cycle through falling garbage items
              if (e.key === "Tab"){
                e.preventDefault();
                let sortableGarbage = garbage.filter(g=> g.falling || (g.y + g.size < canvas.height - binFrontHeight));

                if(!timer.isPaused() && sortableGarbage.length > 0){
                  let currentIndex = selectedGarbageItem ? sortableGarbage.indexOf(selectedGarbageItem) : -1;
                  let nextIndex = (currentIndex + 1) % sortableGarbage.length;

                  selectedGarbageItem = sortableGarbage[nextIndex];
                  selectionLocked = true;
                  selectedSortableIndex = nextIndex;

                  updateAltText(`Selected ${selectedGarbageItem.image.alt}. Item ${selectedSortableIndex + 1} of ${sortableGarbage.length}`);
                  } else {
                    updateAltText("No falling waste to select.");
                    selectedGarbageItem = null;
                    selectionLocked = false;
                    selectedGarbageIndex = -1
                  }
              }
              if (garbage.length > 0 && selectedGarbageItem == null && !selectionLocked) {
                let sortableGarbage = garbage.filter(g=> g.falling || (g.y + g.size < canvas.height - binFrontHeight));
                if(sortableGarbage.length > 0){ 
                    selectedGarbageItem = sortableGarbage[0];
                    selectionLocked = true;
                    selectedSortableIndex = 0;
                    updateAltText(`Selected ${selectedGarbageItem.image.alt} for sorting.`);
                  }
              }

              if (e.key === "1" || e.key === "2" || e.key === "3" || e.key === "4"){
                if(!timer.isPaused() && selectedGarbageItem){
                  let targetBin = -1;
                  let binName = "";

                  if(e.key === "1"){
                    targetBin = paper;
                    binName = "Paper";
                  } else if (e.key === "2"){
                    targetBin = comingled;
                    binName = "Plastic, Glass, and Metal";
                  } else if (e.key === "3"){
                    targetBin = organics;
                    binName = "Organics";
                  } else if (e.key === "4"){
                    targetBin = landfill;
                    binName = "Landfill";
                  }
                
                  let selectedGarbage = selectedGarbageItem;
                  let targetX;
                  let targetY = canvas.height - binFrontHeight - selectedGarbage.size;

                  const paperBinX=0;
                  const comingledBinX=binWidth;
                  const organicsBinX=binWidth*2;
                  const landfillBinX=binWidth*3;

                  switch(targetBin){
                      case paper:
                        targetX = paperBinX + binWidth/2 - selectedGarbage.size/2;
                        break;
                      case comingled:
                        targetX = comingledBinX + binWidth/2 - selectedGarbage.size/2;
                        break;
                      case organics:
                        targetX = organicsBinX + binWidth/2 - selectedGarbage.size/2;
                        break;
                      case landfill:
                        targetX = landfillBinX + binWidth/2 - selectedGarbage.size/2;
                        break;
                      default:
                        targetX = selectedGarbage.x;
                    }

                    selectedGarbage.x=targetX;
                    selectedGarbage.y=targetY;
                    selectedGarbage.falling = false;

                    if(selectedGarbage.type === targetBin){
                      updateAltText('Correct! ' + selectedGarbage.image.alt + ' placed in ' + binName + ' bin.');
                      if (targetBin !== landfill){
                        recyclingSorted++;
                      } else {
                        landfillSorted++;
                      }
                      scorePercentage = Number((recyclingSorted/startingGarbageCount)*100).toFixed(0);
                      selectedGarbageItem = null;
                      selectionLocked = false;
                      selectedSortableIndex -1;
                    } else { 
                      updateAltText('Oops! ' + selectedGarbage.image.alt + ' does not go in ' + binName + 'bin.');
                      selectedLocked = true;
                    }
                  } else if (!selectedGarbageItem){
                    updateAltText("No falling waste to sort.");
                  }
                }
                         
            else if (currentState == state.END) {
              if (restartButton.clicked(x, y)) {
                if (!muted) {
                  buttonSound.load();
                  buttonSound.play();
                }

                if (gameTitle == "matching") {
                  currentState = state.MATCHLEVEL;
                } else {
                  currentState = state.SORTLEVEL;
                }
              }
            
              if (homeButton.clicked(x, y)) {
                if (!muted) {
                  buttonSound.load();
                  buttonSound.play();
                }

                currentState = state.CHOOSEGAME;
              }

              toggleAudio(x, y);
            } else if (currentState == state.CHOOSEGAME) {
              if (e.key == "1") {
                if (!muted) {
                  backgroundMusic.play();
                  buttonSound.load();
                  buttonSound.play();
                }

                currentState = state.MATCHINTRO1;

                updateAltText(
                  "Recology Davis picks up all the trash, recycling and organics from Davis."
                );
              }
            } else if (currentState == state.MATCHINTRO1) {
              if (e.key == "Enter") {
                if (!muted) {
                  backgroundMusic.play();
                  buttonSound.load();
                  buttonSound.play();
                }

                currentState = state.MATCHINTRO2;

                updateAltText(
                  "Recyclables are brought to the recycling center in Davis. Organics are sent to the composting facility at the Yolo County landfill. Trash is buried in the Yolo County landfill."
                );
              }
            } else if (currentState == state.MATCHINTRO2) {
              if (e.key == "Enter") {
                if (!muted) {
                  backgroundMusic.play();
                  buttonSound.load();
                  buttonSound.play();
                }

                currentState = state.MATCHINTRO3;

                updateAltText(
                  "Click on two cards to find a match and learn which materials can be recycled and composted."
                );
              }
            } else if (currentState == state.MATCHINTRO3) {
              if (e.key == "Enter") {
                if (!muted) {
                  backgroundMusic.play();
                  buttonSound.load();
                  buttonSound.play();
                }

                currentState = state.MATCHLEVEL;

                updateAltText("Choose a level to start the game!");
              }
            } else if (currentState == state.MATCHLEVEL) {
              if (e.key == "1") {
                level = 1;
              } else if (e.key == "2") {
                level = 2;
              } else if (e.key == "3") {
                level = 3;
              }

              setMatchLevelBoard();

              currentState = state.PLAYMATCH;

              pauseButton.image = pauseButtonImg;
              pauseButton.x = canvas.width - originalPlayButtonSize * 2;
              pauseButton.y = canvas.height - originalPlayButtonSize - 15;

              homeButton.x =
                canvas.width / 2 - originalPlayButtonSize * 2 - originalPlayButtonSize / 4;
              homeButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
              homeButton.size = originalPlayButtonSize;

              restartButton.x =
                canvas.width / 2 - originalPlayButtonSize + originalPlayButtonSize / 8;
              restartButton.y =
                canvas.height / 2 - originalPlayButtonSize / 2 - originalPlayButtonSize / 8;
              restartButton.size = originalPlayButtonSize;

              muteButton.x =
                canvas.width / 2 - originalPlayButtonSize + originalPlayButtonSize / 8;
              muteButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
              muteButton.size = originalPlayButtonSize;

              if (!muted) {
                backgroundMusic.pause();
                matchingMusic.currentTime = 0;
                matchingMusic.play();
              }

              timer.setTimerTime(timerTime);
              timer.start();
            } else if (currentState == state.PLAYMATCH) {
              if (score != (tiles.length * 50) / 2) {
                toggleAudio(x, y);
              }

              for (i = 0; i < tiles.length; i++) {
                if (
                  tiles[i].clicked(x, y) &&
                  !timer.isPaused() &&
                  !tiles[i].flipped &&
                  !tiles[i].matched &&
                  numberTilesFlipped < 2 &&
                  !timer.isMatchDelayed() &&
                  !timer.isEndDelayed()
                ) {
                  tiles[i].flipped = true;

                  if (numberTilesFlipped == 1) {
                    secondFlippedTileIndex = i;
                  } else {
                    if (!muted) {
                      tileFlipSound.load();
                      tileFlipSound.play();
                    }

                    firstFlippedTileIndex = i;
                  }

                  numberTilesFlipped++;

                  if (numberTilesFlipped == 2) {
                    if (
                      tiles[firstFlippedTileIndex].image ==
                      tiles[secondFlippedTileIndex].image
                    ) {
                      if (!muted) {
                        tileMatchSound.load();
                        tileMatchSound.play();
                      }

                      tiles[firstFlippedTileIndex].matched = true;
                      tiles[secondFlippedTileIndex].matched = true;

                      switch (tiles[firstFlippedTileIndex].image) {
                        case glassJarMatchImg:
                          matchInfoImage = glassJarMatchImg;
                          matchInfoString1 = "Glass food jars can be recycled.";
                          updateAltText(
                            `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                              matchInfoString1
                          );
                          matchInfoString2 = "";
                          break;

                        // other cases unchanged...
                      }

                      displayMatchInfo = true;
                      score += 50;

                      if (score != (tiles.length * 50) / 2) {
                        timer.matchDelay();
                      } else {
                        timer.endDelay();
                      }
                    } else {
                      updateAltText(
                        `You tried matching ${tiles[firstFlippedTileIndex].image.alt} and ${tiles[secondFlippedTileIndex].image.alt}`
                      );
                      if (!muted) {
                        tileFlipSound.load();
                        tileFlipSound.play();
                      }

                      timer.missDelay();
                    }
                  }
                }
              }
            } else if(currentState == state.CHOOSEGAME) {
          if(e.key == "1") {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.MATCHINTRO1
            
            updateAltText("Recology Davis picks up all the trash, recycling and organics from Davis.")
          }
        } else if(currentState == state.MATCHINTRO1) {
          if(e.key == "Enter") {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.MATCHINTRO2

            updateAltText("Recyclables are brought to the recycling center in Davis. Organics are sent to the composting facility at the Yolo County landfill. Trash is buried in the Yolo County landfill.")
          }
        } else if(currentState == state.MATCHINTRO2) {
          if(e.key == "Enter") {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.MATCHINTRO3

            updateAltText("Click on two cards to find a match and learn which materials can be recycled and composted.")
          }
        } else if (currentState == state.MATCHINTRO3) {
          if(e.key == "Enter") {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.MATCHLEVEL

            updateAltText("Choose a level to start the game!")
          }
        } else if (currentState == state.MATCHLEVEL) {
            if (e.key == "1") {
              level = 1;
            } else if (e.key == "2") {
              level = 2;
            } else if (e.key == "3") {
              level = 3;
            }

            setMatchLevelBoard();

            currentState = state.PLAYMATCH;

            pauseButton.image = pauseButtonImg;
            pauseButton.x = canvas.width - originalPlayButtonSize * 2;
            pauseButton.y = canvas.height - originalPlayButtonSize - 15;

            homeButton.x =
              canvas.width / 2 -
              originalPlayButtonSize * 2 -
              originalPlayButtonSize / 4;
            homeButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            homeButton.size = originalPlayButtonSize;

            restartButton.x =
              canvas.width / 2 -
              originalPlayButtonSize +
              originalPlayButtonSize / 8;
            restartButton.y =
              canvas.height / 2 -
              originalPlayButtonSize / 2 -
              originalPlayButtonSize / 8;
            restartButton.size = originalPlayButtonSize;

            muteButton.x =
              canvas.width / 2 -
              originalPlayButtonSize +
              originalPlayButtonSize / 8;
            muteButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            muteButton.size = originalPlayButtonSize;

            if (!muted) {
              backgroundMusic.pause();
              matchingMusic.currentTime = 0;
              matchingMusic.play();
            }

            timer.setTimerTime(timerTime);
            timer.start();
          } else if (currentState == state.PLAYMATCH) {
            if (score != (tiles.length * 50) / 2) {
              toggleAudio(x, y);
            }

            for (i = 0; i < tiles.length; i++) {
              if (
                tiles[i].clicked(x, y) &&
                !timer.isPaused() &&
                !tiles[i].flipped &&
                !tiles[i].matched &&
                numberTilesFlipped < 2 &&
                !timer.isMatchDelayed() &&
                !timer.isEndDelayed()
              ) {
                tiles[i].flipped = true;

                if (numberTilesFlipped == 1) {
                  secondFlippedTileIndex = i;
                } else {
                  if (!muted) {
                    tileFlipSound.load();
                    tileFlipSound.play();
                  }

                  firstFlippedTileIndex = i;
                }

                numberTilesFlipped++;

                if (numberTilesFlipped == 2) {
                  if (
                    tiles[firstFlippedTileIndex].image ==
                    tiles[secondFlippedTileIndex].image
                  ) {
                    if (!muted) {
                      tileMatchSound.load();
                      tileMatchSound.play();
                    }

                    tiles[firstFlippedTileIndex].matched = true;
                    tiles[secondFlippedTileIndex].matched = true;

                    switch (tiles[firstFlippedTileIndex].image) {
                      case bananaMatchImg:
                        matchInfoImage = bananaMatchImg;
                        matchInfoString1 =
                          "Banana peels can be composted with other organics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case bottleMatchImg:
                        matchInfoImage = bottleMatchImg;
                        matchInfoString1 =
                          "Plastic bottles can be recycled with other plastics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case chipsMatchImg:
                        matchInfoImage = chipsMatchImg;
                        matchInfoString1 = "Chip bags should be placed in the trash.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case grassMatchImg:
                        matchInfoImage = grassMatchImg;
                        matchInfoString1 =
                          "Grass clippings can be composted with other organics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case newsPaperMatchImg:
                        matchInfoImage = newsPaperMatchImg;
                        matchInfoString1 =
                          "Newspaper can be recycled with other papers.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case paperCupMatchImg:
                        matchInfoImage = paperCupMatchImg;
                        matchInfoString1 =
                          "Coffee cups can be composted with other organics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case paperTowelsMatchImg:
                        matchInfoImage = paperTowelsMatchImg;
                        matchInfoString1 =
                          "Paper towels can be composted with other organics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case plasticBagMatchImg:
                        matchInfoImage = plasticBagMatchImg;
                        matchInfoString1 = "Plastic bags should be placed in the trash.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case strawAndLidMatchImg:
                        matchInfoImage = strawAndLidMatchImg;
                        matchInfoString1 =
                          "Plastic straws and disposable cup lids can be";
                        matchInfoString2 = "recycled with other plastics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1 +
                            " " +
                            matchInfoString2
                        );
                        break;
                      case coffeeLidMatchImg:
                        matchInfoImage = coffeeLidMatchImg;
                        matchInfoString1 =
                          "Disposable plastic coffee cup lids can be recycled";
                        matchInfoString2 = "with other plastics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1 +
                            " " +
                            matchInfoString2
                        );
                        break;
                      case appleMatchImg:
                        matchInfoImage = appleMatchImg;
                        matchInfoString1 =
                          "Apple cores can be composted with other organics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case glassJarMatchImg:
                        matchInfoImage = glassJarMatchImg;
                        matchInfoString1 = "Glass food jars can be recycled.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case mailMatchImg:
                        matchInfoImage = mailMatchImg;
                        matchInfoString1 =
                          "Mail can be recycled with other papers.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case petWasteMatchImg:
                        matchInfoImage = petWasteMatchImg;
                        matchInfoString1 = "Pet waste should be placed in the trash.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case paperPlatesMatchImg:
                        matchInfoImage = paperPlatesMatchImg;
                        matchInfoString1 =
                          "Paper plates can be composted with other organics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case takeOutBoxMatchImg:
                        matchInfoImage = takeOutBoxMatchImg;
                        matchInfoString1 =
                          "Chopsticks and take-out food boxes can be composted";
                        matchInfoString2 = "with other organics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1 +
                            " " +
                            matchInfoString2
                        );
                        break;
                      case bonesMatchImg:
                        matchInfoImage = bonesMatchImg;
                        matchInfoString1 =
                          "Meat and bones can be composted with other organics.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case milkCartonMatchImg:
                        matchInfoImage = milkCartonMatchImg;
                        matchInfoString1 =
                          "Milk cartons can be composted with other organics.";
                        updateAltText(matchInfoString1);
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case paperBagMatchImg:
                        matchInfoImage = paperBagMatchImg;
                        matchInfoString1 =
                          "Paper bags can be recycled with other papers.";
                        updateAltText(matchInfoString1);
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case sodaCanMatchImg:
                        matchInfoImage = sodaCanMatchImg;
                        matchInfoString1 =
                          "Aluminum cans may be recycled with other metals.";
                        updateAltText(matchInfoString1);
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1
                        );
                        matchInfoString2 = "";
                        break;
                      case brokenPlateMatchImg:
                        matchInfoImage = brokenPlateMatchImg;
                        matchInfoString1 =
                          "Broken dishes and glassware should be placed in";
                        matchInfoString2 = "the trash.";
                        updateAltText(
                          `You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` +
                            matchInfoString1 +
                            " " +
                            matchInfoString2
                        );
                        break;
                      default:
                        updateAltText(
                          `You have matched the ${tiles[index].image.alt}'s.`
                        );
                    }

                    displayMatchInfo = true;

                    score += 50;

                    if (score != (tiles.length * 50) / 2) {
                      timer.matchDelay();
                    } else {
                      timer.endDelay();
                    }
                  } else {
                    updateAltText(
                      `You tried matching ${tiles[firstFlippedTileIndex].image.alt} and ${tiles[secondFlippedTileIndex].image.alt}`
                    );
                    if (!muted) {
                      tileFlipSound.load();
                      tileFlipSound.play();
                    }

                    timer.missDelay();
                  }
                }
              }
            }

            if (pauseButton.clicked(x, y) && score != (tiles.length * 50) / 2) {
              if (
                !timer.isPaused() &&
                !timer.isMatchDelayed() &&
                !timer.isEndDelayed()
              ) {
                if (!muted) {
                  buttonSound.load();
                  buttonSound.play();
                }

                timer.pause();
                pauseButton.image = playButtonImg;
                pauseButton.x =
                  canvas.width / 2 -
                  originalPlayButtonSize * 2 -
                  originalPlayButtonSize / 4;
                pauseButton.y =
                  canvas.height / 2 -
                  originalPlayButtonSize / 2 -
                  originalPlayButtonSize / 8;
              } else if (!timer.isMatchDelayed() && !timer.isEndDelayed()) {
                if (!muted) {
                  buttonSound.load();
                  buttonSound.play();
                }

                timer.unpause();
                pauseButton.image = pauseButtonImg;
                pauseButton.x = canvas.width - originalPlayButtonSize * 2;
                pauseButton.y = canvas.height - originalPlayButtonSize - 15;
              }
            }

            if (restartButton.clicked(x, y) && timer.isPaused()) {
              if (!muted) {
                buttonSound.load();
                buttonSound.play();

                matchingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
              }

              currentState = state.MATCHLEVEL;

              homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
              homeButton.y =
                canvas.height / 2 +
                canvas.height / 4 -
                originalPlayButtonSize / 2;

              restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
              restartButton.y =
                canvas.height / 2 +
                canvas.height / 4 -
                originalPlayButtonSize / 2;

              muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
              muteButton.y = soundButtonSize / 8;
              muteButton.size = soundButtonSize;
            }

            if (homeButton.clicked(x, y) && timer.isPaused()) {
              if (!muted) {
                buttonSound.load();
                buttonSound.play();

                matchingMusic.pause();
                backgroundMusic.currentTime = 0;
                backgroundMusic.play();
              }

              currentState = state.CHOOSEGAME;

              homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
              homeButton.y =
                canvas.height / 2 +
                canvas.height / 4 -
                originalPlayButtonSize / 2;

              restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
              restartButton.y =
                canvas.height / 2 +
                canvas.height / 4 -
                originalPlayButtonSize / 2;

              muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
              muteButton.y = soundButtonSize / 8;
              muteButton.size = soundButtonSize;
            }
          }
      }});

      document.addEventListener("keyup", (e) => {
        keys[e.key] = false;
        
      });

      document.addEventListener("mousedown", clickHandler, false);

      document.addEventListener("mousedown", mouseDownHandler, false);
      document.addEventListener("mousemove", mouseMoveHandler, false);
      document.addEventListener("mouseup", mouseUpHandler, false);

      document.addEventListener("touchstart", touch2Mouse, true);
      document.addEventListener("touchmove", touch2Mouse, true);
      document.addEventListener("touchend", touch2Mouse, true);

      function isGameplayActive() {
        return !timer.isPaused() && 
          (currentState === state.PLAYSORT);
      }

      // Make Alt Text div not viewable and only readable via tool
       document.getElementById("altText").style.position = "absolute";
       document.getElementById("altText").style.left = "-9999px";

      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");
      var contextScale = 0.68;
      //ctx.scale(contextScale,contextScale);

      var state = {
        WELCOME1: 0,
        WELCOME2: 1,
        CHOOSEGAME: 2,
        MATCHINTRO1: 3,
        MATCHINTRO2: 4,
        MATCHINTRO3: 5,
        MATCHLEVEL: 6,
        PLAYMATCH: 7,
        END: 8,
        SORTINTRO1: 9,
        SORTINTRO2: 10,
        SORTLEVEL: 11,
        PLAYSORT: 12,
        MAININTRO: 13,
        LOADING: 14,
      };

      // One source of lookup for all image variables
const IMG_VARS = [
  // screens & UI
  'mainIntroImg','welcome1Img','welcome2Img','chooseGameImg','matchingIntro1Img',
  'matchingIntro2Img','matchingIntro3Img','matchingLevelSelectImg','endScreenMatchingImg',
  'sortingIntro1Img','sortingIntro2Img','sortingLevelSelectImg','endScreenSortingImg',
  'pauseScreenImg',
  'matchingButtonImg','sortingButtonImg','muteImg','unmuteImg','pauseButtonImg',
  'playButtonImg','level1Img','level2Img','level3Img','restartButtonImg','homeButtonImg',

  // match images (with color)
  'bananaMatchImg','bottleMatchImg','chipsMatchImg','grassMatchImg','newsPaperMatchImg',
  'paperCupMatchImg','paperTowelsMatchImg','plasticBagMatchImg','strawAndLidMatchImg',
  'appleMatchImg','bonesMatchImg','coffeeLidMatchImg','glassJarMatchImg','mailMatchImg',
  'milkCartonMatchImg','paperPlatesMatchImg','petWasteMatchImg','takeOutBoxMatchImg',
  'paperBagMatchImg','sodaCanMatchImg','brokenPlateMatchImg','canMatchImg','cardboardMatchImg',
  'cerealMatchImg','diaperMatchImg','glassBottleMatchImg','pumpkinMatchImg','styrofoamMatchImg',
  'leafMatchImg','papersMatchImg','juiceMatchImg','eggsMatchImg','stickMatchImg',
  'candyMatchImg','paperRollMatchImg','aluminumFoilMatchImg',

  // grayscale set
  'bananaGSImg','bottleGSImg','chipsGSImg','newsPaperGSImg','sodaCanGSImg','appleGSImg',
  'brokenPlateGSImg','canGSImg','cardboardGSImg','cerealGSImg','diaperGSImg','glassBottleGSImg',
  'glassJarGSImg','grassGSImg','leafGSImg','mailGSImg','papersGSImg','plasticBagGSImg',
  'pumpkinGSImg','styrofoamGSImg','milkGSImg','juiceGSImg','eggsGSImg','strawGSImg',
  'chineseGSImg','stickGSImg','candyGSImg','poopGSImg','paperRollGSImg','paperBagGSImg',
  'aluminumFoilGSImg','coffeeLidGSImg',

  // boards/bins
  'matchingCardImg','cardFrontImg','sortingBackgroundImg','paperBackImg','paperFrontImg',
  'comingledBackImg','comingledFrontImg','organicsBackImg','organicsFrontImg',
  'landfillBackImg','landfillFrontImg'
];


      var currentState = state.LOADING;

      var mouseDown = false;

      var percent;
      var timerBarHeight = 30;
      var timerBarWidth = 0;

      let timerFreeze = false;//for 't' timer function
      let tFreezeStart = 0;
      let tFrozenAccum = 0;
          

      var score = 0;

      var level;

      var gameTitle;

      var timer = new Timer();
      var timerTime;
      var timeElapsed = Number(0).toFixed(2);

      var chooseButtonSize = 200;
      var originalPlayButtonSize = 100;
      var soundButtonSize = 75;
      var currentPlayButtonSize = originalPlayButtonSize;
      var sortButtonSize = 75;

      var levelButtonWidth = 125;
      var levelButtonHeight = 50;

      var increaseChooseButtonSize = true;
      var increasePlayButtonSize = true;
      var increaseLevelButtonSize = true;

      var tileRowCount;
      var tileColumnCount;
      var tileSize;
      var tilePadding;
      var tileOffsetTop;
      var tileOffsetLeft;

      var tiles;

      var backgroundMusic = new Audio();
      var matchingMusic = new Audio();

      var sortingMusic = new Audio();

      var buttonSound = new Audio();
      var tileFlipSound = new Audio();
      var tileMatchSound = new Audio();

          //  global volume slider
    //const volumeSlider = document.getElementById('volumeSlider');

    volumeSlider.addEventListener('input', () => {
      
      const v = Number(volumeSlider.value) / 100;
      if (v > 0 && isMuted) {
        isMuted = false;
        muted = false;

        // Resume the appropriate music
        if (currentState === state.PLAYMATCH) {
          matchingMusic.play();
        } else if (currentState === state.PLAYSORT) {
          sortingMusic.play();
        } else {
          backgroundMusic.play();
        }

        updateAltText("Sound unmuted.");
      }

      backgroundMusic.volume = v;
      matchingMusic.volume = v;
      sortingMusic.volume = v;
      buttonSound.volume = v;
      tileFlipSound.volume = v;
      tileMatchSound.volume = v;

      if(!isMuted) previousVolume=v;
    });

    const pauseVolumeSlider = document.getElementById('pauseVolumeSlider');

        pauseVolumeSlider.addEventListener('input', () => {
          const v = Number(pauseVolumeSlider.value) / 100;

          // If slider dragged up from 0 while muted  unmute
          if (v > 0 && isMuted) {
            isMuted = false;
            muted = false;

            if (currentState === state.PLAYMATCH) {
              matchingMusic.play();
            } else if (currentState === state.PLAYSORT) {
              sortingMusic.play();
            } else {
              backgroundMusic.play();
            }
            updateAltText("Sound unmuted");
          }

          backgroundMusic.volume = v;
          matchingMusic.volume = v;
          sortingMusic.volume = v;
          buttonSound.volume = v;
          tileFlipSound.volume = v;
          tileMatchSound.volume = v;

          // Sync both sliders
          volumeSlider.value = pauseVolumeSlider.value;

          if(!isMuted) previousVolume=v;
      });
     const month = 11; //new Date().getMonth(); // 3 = spring, 6 = summer, 11 = winter, 10 = fall but not original art

     //const month =11;

      var muted = false;

      for (i = 0; i < IMG_VARS.length; i++) {
        window[IMG_VARS[i]] = new Image();
      }


      var loadingImg = image("Images/Screens/loadScreen.png");



      var numberLoaded = 0;
      var numberOfAssets = IMG_VARS.length;

      var selectedTileIndex = -1; // Index of the currently selected tile for keyboard navigation
        

      function loadAssets() {
        const finishedLoading = () => { numberLoaded++; };

        // Attach one onload listener to each image
        IMG_VARS.forEach(name => {
          const img = window[name];
          img.onload = finishedLoading;
        });


        //Images

//Start
        //if(month === 10 || month === 11){loadingImg.src = "Images/Seasonal/loadScreenWinter.png";} else if (month === 9){loadingImg.src = "Images/Seasonal/loadScreenHolloween.png";} else {loadingImg.src = "Images/Screens/loadScreen.png";}
        //plasticBagMatchImg.src = `Images/Seasonal/plasticBag${fileNameAdd}.png`;

const season =
  (month >= 2 && month <= 4) ? "Spring" :   // MarMay
  (month >= 5 && month <= 7) ? "Summer" :   // JunAug
  (month >= 8 && month <= 10) ? "Holloween" : // SepNov 
  (month === 11 || month <= 1) ? "Winter" :  // DecFeb
  "";

// Screen function helper
function setScreen(img, stem) {
  if (season) {
    img.src = `Images/Seasonal/${stem}${season}.png`;
  } else {
    img.src = `Images/Screens/${stem}.png`;
  }
}

//  list of screens to set
const SCREENS = [
  [mainIntroImg,          "mainIntro"],
  [welcome1Img,           "welcome1"],
  [welcome2Img,           "welcome2"],
  [chooseGameImg,         "chooseGame"],
  [matchingIntro1Img,     "matchingIntro1"],
  [matchingIntro2Img,     "matchingIntro2"],
  [matchingIntro3Img,     "matchingIntro3"],
  [matchingLevelSelectImg,"chooseLevelMatching"], // note stem
  [endScreenMatchingImg,  "endScreenMatching"],
  [sortingIntro1Img,      "sortingIntro1"],
  [sortingIntro2Img,      "sortingIntro2"],
  [sortingLevelSelectImg, "chooseLevelSorting"],  // note stem
  [endScreenSortingImg,   "endScreenSorting"],
  [pauseScreenImg,        "pauseScreen"],
  [sortingBackgroundImg,  "sortingBackground"],
];


SCREENS.forEach(([img, stem]) => setScreen(img, stem));
// End Screens & UI 

      // Some Seasonal Exceptions
        if (month === 9) {pumpkinMatchImg.src = "Images/Seasonal/jackolanturn.png";} else {pumpkinMatchImg.src = "Images/Clear/pumpkinClr.png";} //Seasonal
        if(month === 10 || month === 11) {paperRollMatchImg.src = "Images/Seasonal/paperRoll.png"} else {paperRollMatchImg.src = "Images/Clear/paperRollClr.png";}// October = Halloween
        if (month === 9) {plasticBagMatchImg.src = "Images/Seasonal/plasticBag.png";} else {plasticBagMatchImg.src = "Images/Clear/plasticBagClr.png";}  //Seasonal
        if (month === 10 || month === 11){bonesMatchImg.src = "Images/Seasonal/turkeyLeg.png";} else{bonesMatchImg.src = "Images/Clear/bonesClr.png";}

// Helper to assign src for a group of images
function setImages(map, folder, suffix = "") {
  map.forEach(([img, name]) => {
    img.src = `Images/${folder}/${name}${suffix}.png`;
  });
}

// --- Buttons ---
setImages([
  [matchingButtonImg, "matchingButton"],
  [sortingButtonImg, "sortingButton"],
  [muteImg, "muteButton"],
  [unmuteImg, "unmuteButton"],
  [pauseButtonImg, "pauseButton"],
  [playButtonImg, "playButton"],
  [level1Img, "level1"],
  [level2Img, "level2"],
  [level3Img, "level3"],
  [restartButtonImg, "restartButton"],
  [homeButtonImg, "homeButton"],
  [helpButtonImg, "gear"]
], "Buttons");


// --- Clear match images ---
setImages([
  [bananaMatchImg, "bananaPeelClr"],
  [bottleMatchImg, "bottleClr"],
  [chipsMatchImg, "chipsClr"],
  [grassMatchImg, "grassClr"],
  [newsPaperMatchImg, "newsPaperClr"],
  [paperCupMatchImg, "paperCupClr"],
  [paperTowelsMatchImg, "paperTowelsClr"],
  [strawAndLidMatchImg, "StrawAndLidClr"],
  [appleMatchImg, "appleClr"],
  [coffeeLidMatchImg, "coffeeLidClr"],
  [glassJarMatchImg, "glassJarClr"],
  [mailMatchImg, "mailClr"],
  [milkCartonMatchImg, "milkCartonClr"],
  [paperPlatesMatchImg, "paperPlatesClr"],
  [petWasteMatchImg, "petWasteClr"],
  [takeOutBoxMatchImg, "takeOutClr"],
  [paperBagMatchImg, "paperBagClr"],
  [sodaCanMatchImg, "sodaCanClr"],
  [brokenPlateMatchImg, "brokenPlateClr"],
  [canMatchImg, "canClr"],
  [cardboardMatchImg, "cardboardClr"],
  [cerealMatchImg, "cerealClr"],
  [diaperMatchImg, "diaperClr"],
  [glassBottleMatchImg, "glassBottleClr"],
  [styrofoamMatchImg, "styrofoamClr"],
  [leafMatchImg, "leafClr"],
  [papersMatchImg, "papersClr"],
  [juiceMatchImg, "juiceBoxClr"],
  [eggsMatchImg, "eggCartonClr"],
  [stickMatchImg, "stickClr"],
  [candyMatchImg, "candyBarClr"],
  [aluminumFoilMatchImg, "aluminumFoilClr"]
], "Clear");

// --- Grayscale images ---
setImages([
  [bananaGSImg, "bananaPeelGS"],
  [bottleGSImg, "bottleGS"],
  [chipsGSImg, "chipsGS"],
  [newsPaperGSImg, "newsPaperGS"],
  [sodaCanGSImg, "sodaCanGS"],
  [appleGSImg, "appleGS"],
  [brokenPlateGSImg, "brokenPlateGS"],
  [canGSImg, "canGS"],
  [cardboardGSImg, "cardboardGS"],
  [cerealGSImg, "cerealGS"],
  [diaperGSImg, "diaperGS"],
  [glassBottleGSImg, "glassBottleGS"],
  [glassJarGSImg, "glassJarGS"],
  [grassGSImg, "grassGS"],
  [leafGSImg, "leafGS"],
  [mailGSImg, "mailGS"],
  [papersGSImg, "papersGS"],
  [plasticBagGSImg, "plasticBagGS"],
  [pumpkinGSImg, "pumpkinGS"],
  [styrofoamGSImg, "styrofoamGS"],
  [milkGSImg, "milkCartonGS"],
  [juiceGSImg, "juiceBoxGS"],
  [eggsGSImg, "eggCartonGS"],
  [strawGSImg, "StrawAndLidGS"],
  [chineseGSImg, "takeOutGS"],
  [stickGSImg, "stickGS"],
  [candyGSImg, "candyBarGS"],
  [poopGSImg, "petWasteGS"],
  [paperRollGSImg, "paperRollGS"],
  [paperBagGSImg, "paperBagGS"],
  [aluminumFoilGSImg, "aluminumFoilGS"],
  [coffeeLidGSImg, "coffeeLidGS"]
], "Grayscale");

// --- Other ---
setImages([
  [matchingCardImg, "matchingCard"],
  [cardFrontImg, "cardFront"],
  [paperBackImg, "paperBack"],
  [paperFrontImg, "paperFront"],
  [comingledBackImg, "comingledBack"],
  [comingledFrontImg, "comingledFront"],
  [organicsBackImg, "organicsBack"],
  [organicsFrontImg, "organicsFront"],
  [landfillBackImg, "landfillBack"],
  [landfillFrontImg, "landfillFront"]
], "Other");

        
        
        mainIntroImg.alt = "The game name in the middle of the Page, Goes Zero Waste. Shows professor Davis Green standing next to the 3 trash cans labeled: Paper, Plastic, Glass & Metal, and Organics.";
        welcome1Img.alt = "Professor Davis Green says, 'Hi friends I'm Professor David Green. Keep waste out of landfills by recycling and composting is important.'";
        welcome2Img.alt = "Professor Davis Green says, 'I need your help. Will you help me divert waste form the landfill.'";
        chooseGameImg.alt = "Professor Davis Green says, 'Play both games to learn more about keeping waste out of landfills.'";
        matchingIntro1Img.alt = "'Recology Davis picks up all the trash, recycling and organics from Davis.'";
        matchingIntro2Img.alt = "'Recyclables are brought to the recycling center in Davis. Organics are sent to the composting facility at the Yolo County landfill. Trash is buried in the Yolo County landfill.' At the bottom of the page images of a recycling center, composting facility and landfill are shown.";
        matchingIntro3Img.alt = "Professor Davis Green says, 'Click on two cards to find a match and learn which materials can be recycled and composted.'";
        matchingLevelSelectImg.alt = "Proffesor Davis Green says, 'Choose a level to start the game!'";
        endScreenMatchingImg.alt = ""; // Possibly decorative serving no functions
        sortingIntro1Img.alt = "Professor Davis Green says, 'In Davis we sort waste into 4 seperate bins.' Shows an image of a Paper, Plastics, Glass &, Metal, and a Landfill recycling bin at the bottom.";
        sortingIntro2Img.alt = "Professor Davis Green says, 'Sort the falling waste into the correct bin. See how much waste you can keep out of the landfill!' Shows an image of a Paper, Plastics, Glass &, Metal, and a Landfill recycling bin at the bottom.";
        sortingLevelSelectImg.alt = "Professor Davis Green says, 'Select a level to start the game!'";
        endScreenSortingImg.alt = ""; // Possibly decorative serving no functions
        pauseScreenImg.alt = "Game paused.";




        matchingButtonImg.alt = "Button for Zero Waste Matching";
        sortingButtonImg.alt = "Button for Zero Waste Sorting";
        muteImg.alt = "Mute audio Button";
        unmuteImg.alt = "Unmute audio button";
        pauseButtonImg.alt = "Pause button";
        playButtonImg.alt = "Play / Unpause button";
        level1Img.alt = "Level 1 button";
        level2Img.alt = "Level 2 button";
        level3Img.alt = "Level 3 button";
        restartButtonImg.alt = "Restart level button";
        homeButtonImg.alt = "Home button";
        helpButtonImg.alt = "Help button";




        bananaMatchImg.alt = "banana peel";
        bottleMatchImg.alt = "empty soda bottle";
        chipsMatchImg.alt = "empty potato chip bag";
        grassMatchImg.alt = "clump of grass";
        newsPaperMatchImg.alt = "newspaper";
        paperCupMatchImg.alt = "empty coffee cup";
        paperTowelsMatchImg.alt = "paper towel roll";
        plasticBagMatchImg.alt = "empty plastic bag";
        strawAndLidMatchImg.alt = "empty glass bottle";
        appleMatchImg.alt = "apple eaten to the core";
        bonesMatchImg.alt = "bones with no meat";
        coffeeLidMatchImg.alt = "plastic coffee lid";
        glassJarMatchImg.alt = "glass jar";
        mailMatchImg.alt = "ripped open mail envelope";
        milkCartonMatchImg.alt = "milk carton";
        paperPlatesMatchImg.alt = "paper plate";
        petWasteMatchImg.alt = "dog waste";
        takeOutBoxMatchImg.alt = "empty takeout box";
        paperBagMatchImg.alt = "paper grocery store bag";
        sodaCanMatchImg.alt = "crushed soda can";
        brokenPlateMatchImg.alt = "broken porcelain plate";
        canMatchImg.alt = "empty tin can";
        cerealMatchImg.alt = "empty cereal box";
        diaperMatchImg.alt = "baby diaper";
        glassBottleMatchImg.alt = "glass bottle";
        pumpkinMatchImg.alt = "orange pumpkin";
        styrofoamMatchImg.alt = "styrofoam cup";
        leafMatchImg.alt = "tree branch";
        papersMatchImg.alt = "paper folder";
        juiceMatchImg.alt = "juice box";
        eggsMatchImg.alt = "egg carton";
        stickMatchImg.alt = "wooden stick";
        candyMatchImg.alt = "candy bar";
        paperRollMatchImg.alt = "toilet paper roll";
        paperBagMatchImg.alt = "paper grocery store bag";
        aluminumFoilMatchImg.alt = "crumpled aluminum";

        // Ignore grayscale image ALT tags since they are decorational and serve no function

        matchingCardImg.alt = "An unrevealed matching card";
        cardFrontImg.alt = ""; // looks decorational
        sortingBackgroundImg.alt = ""; // decorational
        paperBackImg.alt = ""; // decorational
        paperFrontImg.alt = "Paper recycling bin";
        comingledBackImg.alt = ""; // decorational
        comingledFrontImg.alt = "Plastic, Glass & Metals recycling bin";
        organicsBackImg.alt = ""; // decorational
        organicsFrontImg.alt = "Organics recycling bin";
        landfillBackImg.alt = ""; // decorational
        landfillFrontImg.alt = "Landfill recycling bin";
        //END

        //Audio
        backgroundMusic.loop = true;
        backgroundMusic.src = "Sound/bgMusic.mp3";
        matchingMusic.loop = true;
        matchingMusic.src = "Sound/matchingMusic.mp3";
        sortingMusic.loop = true;
        sortingMusic.src = "Sound/sortingMusic.mp3";
        buttonSound.src = "Sound/buttonPop.mp3";
        tileFlipSound.src = "Sound/swish.mp3";
        tileMatchSound.src = "Sound/ding.mp3";
      }

      function updateAltText(msg) {
        document.getElementById("altText").textContent = msg;
      }

      var dragImg;
      var dragX;
      var dragY;
      var dragOffsetX;
      var dragOffsetY;
      var draggedGarbage = new Garbage(0, 0, 0, 0, 0);

      var binWidth = 960 / 5;
      var binBackHeight = 25;
      var binFrontHeight = 100;

      var sidebarLocalXOrigin = canvas.width - binWidth;
      var sidebarWidth = binWidth;
      var sidebarButtonSize = 60;
      
      var garbageSize = 75;

      var paper = 0;
      var comingled = 1;
      var organics = 2;
      var landfill = 3;

      var recyclingSorted = 0;
      var landfillSorted = 0;
      var scorePercentage = 0;

      var paperColumnStart = 0;
      var comingledColumnStart = binWidth;
      var organicsColumnStart = binWidth * 2;
      var landfillColumnStart = binWidth * 3;

      var paperColumnEnd = paperColumnStart + binWidth;
      var comingledColumnEnd = comingledColumnStart + binWidth;
      var organicsColumnEnd = organicsColumnStart + binWidth;
      var landfillColumnEnd = landfillColumnStart + binWidth;

      var displayMatchInfo;
      var matchInfoImage;
      var matchInfoString1;
      var matchInfoString2;

      var imageIndex;
      var numberTilesFlipped;
      var firstFlippedTileIndex;
      var secondFlippedTileIndex;

      var timerCircleRadius = 60;
      var startAngle = -(Math.PI / 2);
      var endAngle = 0;

      var fallSpeed;
      var dropGarbageInterval;
      var lastDropTime;

      var garbage = [];
      var garbageQueue = [];

      var startingGarbageCount;
      var itemsRemaining;

      var matchingButton = new RectangularButton(
        canvas.width / 4 - chooseButtonSize / 2,
        canvas.height / 4 - chooseButtonSize / 2,
        chooseButtonSize,
        chooseButtonSize,
        matchingButtonImg
      );

      var sortingButton = new RectangularButton(
        canvas.width / 2 + canvas.width / 4 - chooseButtonSize / 2,
        canvas.height / 4 - chooseButtonSize / 2,
        chooseButtonSize,
        chooseButtonSize,
        sortingButtonImg
      );

      var playButton = new CircularButton(
        canvas.width / 2 - originalPlayButtonSize - originalPlayButtonSize / 2,
        canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2,
        originalPlayButtonSize,
        playButtonImg
      );
      console.log("Canvas Width: " + canvas.width);

      var level1Button = new RectangularButton(
        canvas.width / 4 - levelButtonWidth / 2 - levelButtonWidth,
        canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2,
        levelButtonWidth,
        levelButtonHeight,
        level1Img
      );

      var level2Button = new RectangularButton(
        canvas.width / 4,
        canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2,
        levelButtonWidth,
        levelButtonHeight,
        level2Img
      );

      var level3Button = new RectangularButton(
        canvas.width / 4 + levelButtonWidth / 2 + levelButtonWidth,
        canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2,
        levelButtonWidth,
        levelButtonHeight,
        level3Img
      );

      var pauseButton = new CircularButton(
        canvas.width - originalPlayButtonSize * 2,
        canvas.height - originalPlayButtonSize - 15,
        originalPlayButtonSize,
        pauseButtonImg
      );

      var restartButton = new CircularButton(
        canvas.width / 4 - originalPlayButtonSize / 2,
        canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2,
        originalPlayButtonSize,
        restartButtonImg
      );

      var homeButton = new CircularButton(
        canvas.width / 3 + originalPlayButtonSize / 2,
        canvas.height / 2 + canvas.height / 4 - originalPlayButtonSize / 2,
        originalPlayButtonSize,
        homeButtonImg
      );

      var muteButton = new CircularButton(
        canvas.width - soundButtonSize - soundButtonSize / 8,
        soundButtonSize / 8,
        soundButtonSize,
        muteImg
      );

      var helpButton = new CircularButton(
        canvas.width - 150,
        15, 
        60,
        helpButtonImg
      );

      var images = [];

      function setMatchLevelBoard() {
        tiles = [];
        displayMatchInfo = false;
        score = 0;
        imageIndex = 0;
        numberTilesFlipped = 0;
        firstFlippedTileIndex = 0;
        secondFlippedTileIndex = 0;
        gameTitle = "matching";

        if (level == 1) {
          timerTime = 60000;
          tileRowCount = 3;
          tileColumnCount = 6;
          tileSize = 120;
          tilePadding = 15;
          tileOffsetTop = 120;
          tileOffsetLeft = 75;
          images = [
            bananaMatchImg,
            bananaMatchImg,
            bottleMatchImg,
            bottleMatchImg,
            chipsMatchImg,
            chipsMatchImg,
            grassMatchImg,
            grassMatchImg,
            newsPaperMatchImg,
            newsPaperMatchImg,
            paperCupMatchImg,
            paperCupMatchImg,
            paperTowelsMatchImg,
            paperTowelsMatchImg,
            plasticBagMatchImg,
            plasticBagMatchImg,
            strawAndLidMatchImg,
            strawAndLidMatchImg,
          ];
          images.sort(function () {
            return 0.5 - Math.random();
          });
        }

        if (level == 2) {
          timerTime = 75000;
          tileRowCount = 3;
          tileColumnCount = 8;
          tileSize = 95;
          tilePadding = 15;
          tileOffsetTop = 150;
          tileOffsetLeft = 50;
          images = [
            appleMatchImg,
            appleMatchImg,
            paperTowelsMatchImg,
            paperTowelsMatchImg,
            milkCartonMatchImg,
            milkCartonMatchImg,
            paperPlatesMatchImg,
            paperPlatesMatchImg,
            glassJarMatchImg,
            glassJarMatchImg,
            takeOutBoxMatchImg,
            takeOutBoxMatchImg,
            bonesMatchImg,
            bonesMatchImg,
            petWasteMatchImg,
            petWasteMatchImg,
            coffeeLidMatchImg,
            coffeeLidMatchImg,
            mailMatchImg,
            mailMatchImg,
            paperCupMatchImg,
            paperCupMatchImg,
            newsPaperMatchImg,
            newsPaperMatchImg,
          ];
          images.sort(function () {
            return 0.5 - Math.random();
          });
        }

        if (level == 3) {
          timerTime = 90000;
          tileRowCount = 4;
          tileColumnCount = 8;
          tileSize = 90;
          tilePadding = 15;
          tileOffsetTop = 105;
          tileOffsetLeft = 70;
          images = [
            appleMatchImg,
            appleMatchImg,
            paperTowelsMatchImg,
            paperTowelsMatchImg,
            milkCartonMatchImg,
            milkCartonMatchImg,
            paperPlatesMatchImg,
            paperPlatesMatchImg,
            glassJarMatchImg,
            glassJarMatchImg,
            sodaCanMatchImg,
            sodaCanMatchImg,
            paperBagMatchImg,
            paperBagMatchImg,
            petWasteMatchImg,
            petWasteMatchImg,
            coffeeLidMatchImg,
            coffeeLidMatchImg,
            mailMatchImg,
            mailMatchImg,
            paperCupMatchImg,
            paperCupMatchImg,
            newsPaperMatchImg,
            newsPaperMatchImg,
            plasticBagMatchImg,
            plasticBagMatchImg,
            bonesMatchImg,
            bonesMatchImg,
            brokenPlateMatchImg,
            brokenPlateMatchImg,
            takeOutBoxMatchImg,
            takeOutBoxMatchImg,
          ];
          images.sort(function () {
            return 0.5 - Math.random();
          });
        }

        for (i = 0; i < tileColumnCount; i++) {
          for (j = 0; j < tileRowCount; j++) {
            tiles.push(
              new Tile(
                i * (tileSize + tilePadding) + tileOffsetLeft,
                j * (tileSize + tilePadding) + tileOffsetTop,
                tileSize,
                images[imageIndex]
              )
            );

            imageIndex++;
          }
        }

        for (i = 0; i < tiles.length; i++) {
          tiles[i].flipped = false;
          tiles[i].matched = false;
        }
      }

      function setSortLevelBoard() {
        if (level == 1) {
          timerTime = 60000;
          dropGarbageInterval = 2000;
          garbageQueue = [
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              newsPaperMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              cardboardMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              cerealMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              mailMatchImg,
              paper
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              bottleMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              sodaCanMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              canMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              glassBottleMatchImg,
              comingled
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              bananaMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              appleMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              grassMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              pumpkinMatchImg,
              organics
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              chipsMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              brokenPlateMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              diaperMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              plasticBagMatchImg,
              landfill
            ),
          ];
          garbageQueue.sort(function (a, b) {
            return 0.5 - Math.random();
          });
        }

        if (level == 2) {
          timerTime = 60000;
          dropGarbageInterval = 1500;
          garbageQueue = [
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              newsPaperMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              cardboardMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              cerealMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              mailMatchImg,
              paper
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              bottleMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              sodaCanMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              canMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              glassBottleMatchImg,
              comingled
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              bananaMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              appleMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              grassMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              pumpkinMatchImg,
              organics
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              chipsMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              brokenPlateMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              diaperMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              plasticBagMatchImg,
              landfill
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              eggsMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              papersMatchImg,
              paper
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              strawAndLidMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              glassJarMatchImg,
              comingled
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              milkCartonMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              leafMatchImg,
              organics
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              juiceMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              styrofoamMatchImg,
              landfill
            ),
          ];
          garbageQueue.sort(function (a, b) {
            return 0.5 - Math.random();
          });
        }

        if (level == 3) {
          timerTime = 60000;
          dropGarbageInterval = 1000;
          garbageQueue = [
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              newsPaperMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              cardboardMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              cerealMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              mailMatchImg,
              paper
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              bottleMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              sodaCanMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              canMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              glassBottleMatchImg,
              comingled
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              bananaMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              appleMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              grassMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              pumpkinMatchImg,
              organics
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              chipsMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              brokenPlateMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              diaperMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              plasticBagMatchImg,
              landfill
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              eggsMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              papersMatchImg,
              paper
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              strawAndLidMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              glassJarMatchImg,
              comingled
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              milkCartonMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              leafMatchImg,
              organics
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              juiceMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              styrofoamMatchImg,
              landfill
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              paperRollMatchImg,
              paper
            ),
            new Garbage(
              getRandomPaperX(),
              -garbageSize,
              garbageSize,
              paperBagMatchImg,
              paper
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              aluminumFoilMatchImg,
              comingled
            ),
            new Garbage(
              getRandomComingledX(),
              -garbageSize,
              garbageSize,
              coffeeLidMatchImg,
              comingled
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              stickMatchImg,
              organics
            ),
            new Garbage(
              getRandomOrganicsX(),
              -garbageSize,
              garbageSize,
              takeOutBoxMatchImg,
              organics
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              petWasteMatchImg,
              landfill
            ),
            new Garbage(
              getRandomLandfillX(),
              -garbageSize,
              garbageSize,
              candyMatchImg,
              landfill
            ),
          ];
          garbageQueue.sort(function (a, b) {
            return 0.5 - Math.random();
          });
        }

        garbage = [];
        fallSpeed = 2;
        lastDropTime = 0;
        recyclingSorted = 0;
        landfillSorted = 0;
        scorePercentage = 0;
        startingGarbageCount = garbageQueue.length;
        itemsRemaining = startingGarbageCount;
        gameTitle = "sorting";

        garbage = [];
        garbageSelectionOrder=[]
        currentGarbageIndex = 0;
      }

      function image(imageSrc) {
        var image = new Image();

        image.src = imageSrc;

        return image;
      }

      function getRandomPaperX() {
        var min = binWidth;
        var max = canvas.width - binWidth - garbageSize;
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function getRandomComingledX() {
        var min1 = 0;
        var max1 = binWidth - garbageSize;
        var min2 = binWidth * 2;
        var max2 = canvas.width - binWidth - garbageSize;
        min1 = Math.ceil(min1);
        max1 = Math.floor(max1);
        min2 = Math.ceil(min2);
        max2 = Math.floor(max2);
        var value1 = Math.floor(Math.random() * (max1 - min1 + 1)) + min1;
        var value2 = Math.floor(Math.random() * (max2 - min2 + 1)) + min2;
        return Math.random() < 0.5 ? value1 : value2;
      }

      function getRandomOrganicsX() {
        var min1 = 0;
        var max1 = binWidth * 2 - garbageSize;
        var min2 = canvas.width - binWidth * 2;
        var max2 = canvas.width - binWidth - garbageSize;
        min1 = Math.ceil(min1);
        max1 = Math.floor(max1);
        min2 = Math.ceil(min2);
        max2 = Math.floor(max2);
        var value1 = Math.floor(Math.random() * (max1 - min1 + 1)) + min1;
        var value2 = Math.floor(Math.random() * (max2 - min2 + 1)) + min2;
        return Math.random() < 0.5 ? value1 : value2;
      }

      function getRandomLandfillX() {
        var min = 0;
        var max = canvas.width - binWidth * 2 - garbageSize;
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      // Helper to descrive tile state
      function getTileDescription(index){
        if(tiles[index].matched){
          return "This card has been matched.";
        } else if(tiles[index].flipped){
          return "This card is flipped over showing a " + tiles[index].image.alt + ".";
        } else {
          return "This card is face down. Press Space or Enter to flip";
        }
      }

      //Extract match handling logic into a separate function for clarity
      function handleMatch(index){
        if(!muted){
          tileMatchSound.load();
          tileMatchSound.play();
        }

        tiles[firstFlippedTileIndex].matched = true;
        tiles[secondFlippedTileIndex].matched = true;

        switch (tiles[firstFlippedTileIndex].image) {
                    // updateAltText(matchInfoString1) will display the alt text for the displayed fact
                    case bananaMatchImg:
                      matchInfoImage = bananaMatchImg;
                      matchInfoString1 =
                        "Banana peels can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case bottleMatchImg:
                      matchInfoImage = bottleMatchImg;
                      matchInfoString1 =
                        "Plastic bottles can be recycled with other plastics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case chipsMatchImg:
                      matchInfoImage = chipsMatchImg;
                      matchInfoString1 =
                        "Chip bags should be placed in the trash.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case grassMatchImg:
                      matchInfoImage = grassMatchImg;
                      matchInfoString1 =
                        "Grass clippings can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case newsPaperMatchImg:
                      matchInfoImage = newsPaperMatchImg;
                      matchInfoString1 =
                        "Newspaper can be recycled with other papers.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case paperCupMatchImg:
                      matchInfoImage = paperCupMatchImg;
                      matchInfoString1 =
                        "Coffee cups can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case paperTowelsMatchImg:
                      matchInfoImage = paperTowelsMatchImg;
                      matchInfoString1 =
                        "Paper towels can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case plasticBagMatchImg:
                      matchInfoImage = plasticBagMatchImg;
                      matchInfoString1 =
                        "Plastic bags should be placed in the trash.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case strawAndLidMatchImg:
                      matchInfoImage = strawAndLidMatchImg;
                      matchInfoString1 =
                        "Plastic straws and disposable cup lids can be";
                      matchInfoString2 = "recycled with other plastics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1 + " " + matchInfoString2)
                      break;
                    case coffeeLidMatchImg:
                      matchInfoImage = coffeeLidMatchImg;
                      matchInfoString1 =
                        "Disposable plastic coffee cup lids can be recycled";
                      matchInfoString2 = "with other plastics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1 + " " + matchInfoString2)
                      break;
                    case appleMatchImg:
                      matchInfoImage = appleMatchImg;
                      matchInfoString1 =
                        "Apple cores can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case glassJarMatchImg:
                      matchInfoImage = glassJarMatchImg;
                      matchInfoString1 = 
                        "Glass food jars can be recycled.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case mailMatchImg:
                      matchInfoImage = mailMatchImg;
                      matchInfoString1 =
                        "Mail can be recycled with other papers.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case petWasteMatchImg:
                      matchInfoImage = petWasteMatchImg;
                      matchInfoString1 =
                        "Pet waste should be placed in the trash.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case paperPlatesMatchImg:
                      matchInfoImage = paperPlatesMatchImg;
                      matchInfoString1 =
                        "Paper plates can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case takeOutBoxMatchImg:
                      matchInfoImage = takeOutBoxMatchImg;
                      matchInfoString1 =
                        "Chopsticks and take-out food boxes can be composted";
                      matchInfoString2 = "with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1 + " " + matchInfoString2)
                      break;
                    case bonesMatchImg:
                      matchInfoImage = bonesMatchImg;
                      matchInfoString1 =
                        "Meat and bones can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case milkCartonMatchImg:
                      matchInfoImage = milkCartonMatchImg;
                      matchInfoString1 =
                        "Milk cartons can be composted with other organics.";
                      updateAltText(matchInfoString1)
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case paperBagMatchImg:
                      matchInfoImage = paperBagMatchImg;
                      matchInfoString1 =
                        "Paper bags can be recycled with other papers.";
                      updateAltText(matchInfoString1)
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case sodaCanMatchImg:
                      matchInfoImage = sodaCanMatchImg;
                      matchInfoString1 =
                        "Aluminum cans may be recycled with other metals.";
                      updateAltText(matchInfoString1)
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case brokenPlateMatchImg:
                      matchInfoImage = brokenPlateMatchImg;
                      matchInfoString1 =
                        "Broken dishes and glassware should be placed in";
                      matchInfoString2 = "the trash.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1 + " " + matchInfoString2)
                      break;
                    default:
                      updateAltText('You have matched the ${tiles[index].image.alt}\'s.');
                  }

                  displayMatchInfo = true;

                  score += 50;



                  if (score != (tiles.length * 50) / 2) {
                    timer.matchDelay();
                  } else {
                    timer.endDelay();
                  }
      }
      function toggleHelpMenu() {
        const helpCanvas = document.getElementById("helpCanvas");
        const currentDisplay = window.getComputedStyle(helpCanvas).display;


        if (currentDisplay === "none") {
            helpCanvas.style.display = "block";
            drawHelpPanel();
            updateAltText("Help menu opened.");
        } else {
            helpCanvas.style.display = "none";
            updateAltText("Help menu closed.");
        }
      }

      function clickHandler(e) {
        var x = e.pageX - canvas.offsetLeft;
        var y = e.pageY - canvas.offsetTop;
        if (helpButton.clicked(x, y)) {
          if (!muted) {
            buttonSound.load();
            buttonSound.play();
          }
          toggleHelpMenu();
          return;
        }
        if (currentState == state.PLAYMATCH) {
          if (timer.isMatchDelayed()) {
            timer.endMatchDelay();
            timer.update();
            numberTilesFlipped = 0;
          }
        }

        if (currentState == state.MAININTRO) {
          updateAltText("Professor Davis Green. Goes Zero Waste.")
          if (playButton.clicked(x, y)) {
            if (!muted) {
              backgroundMusic.play();
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.WELCOME1;

            updateAltText("Hi friends! I'm Professor Davis Green. Keeping waste out of landfills by recycling and composting is important.")

            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
          }

          toggleAudio(x, y);
        } else if (currentState == state.WELCOME1) {
          if (playButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.WELCOME2;

            updateAltText("I need your help. Will you help me divert waste from the landfill.")

            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
          }

          toggleAudio(x, y);
        } else if (currentState == state.WELCOME2) {
          if (playButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.CHOOSEGAME;

            updateAltText("Play both games to learn more about keeping waste out of landfill. Can select Zero Waste Matching and Zero Waste Sorting.") 
          }

          toggleAudio(x, y);
        } else if (currentState == state.CHOOSEGAME) {
          if (matchingButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.MATCHINTRO1;

            updateAltText("Recology Davis picks up all the trash, recycling and organics from Davis.")

            playButton.x =
              canvas.width / 2 + canvas.width / 4 - originalPlayButtonSize / 2;
            playButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
          } else if (sortingButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.SORTINTRO1;

            updateAltText("In Davis we sort waste into 4 seperate bins. Shows a paper, metal glass and plastic, organics, and a landfill bins.")

            playButton.x = canvas.width / 2 - originalPlayButtonSize / 2;
            playButton.y = canvas.height / 2 - originalPlayButtonSize / 4;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
          }

          toggleAudio(x, y);
        } else if (currentState == state.MATCHINTRO1) {
          if (playButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.MATCHINTRO2;

            updateAltText("Recyclables are brought to the recycling center in Davis. Organics are sent to the composting facility at the Yolo County landfill. Trash is buried in the Yolo County landfill.")

            playButton.x = canvas.width / 2 - originalPlayButtonSize / 2;
            playButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize -
              originalPlayButtonSize / 8;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
          }

          toggleAudio(x, y);
        } else if (currentState == state.MATCHINTRO2) {
          if (playButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.MATCHINTRO3;

            updateAltText("Click on two cards to find a match and learn which materials can be recycled and composted.")

            playButton.x =
              canvas.width / 2 - canvas.width / 4 - originalPlayButtonSize / 2;
            playButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
          }

          toggleAudio(x, y);
        } else if (currentState == state.MATCHINTRO3) {
          if (playButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;

            currentState = state.MATCHLEVEL;

            updateAltText("Choose a level to start the game!")

            level1Button.x =
              canvas.width / 4 - levelButtonWidth / 2 - levelButtonWidth;
            level1Button.y =
              canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2;

            level2Button.x = canvas.width / 4;
            level2Button.y =
              canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2;

            level3Button.x =
              canvas.width / 4 + levelButtonWidth / 2 + levelButtonWidth;
            level3Button.y =
              canvas.height / 2 + canvas.height / 4 - levelButtonHeight / 2;
          }

          toggleAudio(x, y);
        } else if (currentState == state.MATCHLEVEL) {
          toggleAudio(x, y);

          if (
            level1Button.clicked(x, y) ||
            level2Button.clicked(x, y) ||
            level3Button.clicked(x, y)
          ) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            if (level1Button.clicked(x, y)) {
              level = 1;
            }

            if (level2Button.clicked(x, y)) {
              level = 2;
            }

            if (level3Button.clicked(x, y)) {
              level = 3;
            }

            setMatchLevelBoard();

            currentState = state.PLAYMATCH;

            pauseButton.image = pauseButtonImg;
            pauseButton.x = canvas.width - originalPlayButtonSize * 2;
            pauseButton.y = canvas.height - originalPlayButtonSize - 15;

            homeButton.x =
              canvas.width / 2 -
              originalPlayButtonSize * 2 -
              originalPlayButtonSize / 4;
            homeButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            homeButton.size = originalPlayButtonSize;

            restartButton.x =
              canvas.width / 2 -
              originalPlayButtonSize +
              originalPlayButtonSize / 8;
            restartButton.y =
              canvas.height / 2 -
              originalPlayButtonSize / 2 -
              originalPlayButtonSize / 8;
            restartButton.size = originalPlayButtonSize;

            muteButton.x =
              canvas.width / 2 -
              originalPlayButtonSize +
              originalPlayButtonSize / 8;
            muteButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            muteButton.size = originalPlayButtonSize;

            if (!muted) {
              backgroundMusic.pause();
              matchingMusic.currentTime = 0;
              matchingMusic.play();
            }

            timer.setTimerTime(timerTime);
            timer.start();
          }
        } else if (currentState == state.PLAYMATCH) {
          if (score != (tiles.length * 50) / 2) {
            toggleAudio(x, y);
          }

          for (i = 0; i < tiles.length; i++) {
            if (
              tiles[i].clicked(x, y) &&
              !timer.isPaused() &&
              !tiles[i].flipped &&
              !tiles[i].matched &&
              numberTilesFlipped < 2 &&
              !timer.isMatchDelayed() &&
              !timer.isEndDelayed()
            ) {
              tiles[i].flipped = true;

              if (numberTilesFlipped == 1) {
                secondFlippedTileIndex = i;
              } else {
                if (!muted) {
                  tileFlipSound.load();
                  tileFlipSound.play();
                }

                firstFlippedTileIndex = i;
              }

              numberTilesFlipped++;

              if (numberTilesFlipped == 2) {
                if (
                  tiles[firstFlippedTileIndex].image ==
                  tiles[secondFlippedTileIndex].image
                ) 
                  
                {
                  if (!muted) {
                    tileMatchSound.load();
                    tileMatchSound.play();
                  }

                  tiles[firstFlippedTileIndex].matched = true;
                  tiles[secondFlippedTileIndex].matched = true;

                  switch (tiles[firstFlippedTileIndex].image) {
                    // updateAltText(matchInfoString1) will display the alt text for the displayed fact
                    case bananaMatchImg:
                      matchInfoImage = bananaMatchImg;
                      matchInfoString1 =
                        "Banana peels can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case bottleMatchImg:
                      matchInfoImage = bottleMatchImg;
                      matchInfoString1 =
                        "Plastic bottles can be recycled with other plastics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case chipsMatchImg:
                      matchInfoImage = chipsMatchImg;
                      matchInfoString1 =
                        "Chip bags should be placed in the trash.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case grassMatchImg:
                      matchInfoImage = grassMatchImg;
                      matchInfoString1 =
                        "Grass clippings can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case newsPaperMatchImg:
                      matchInfoImage = newsPaperMatchImg;
                      matchInfoString1 =
                        "Newspaper can be recycled with other papers.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case paperCupMatchImg:
                      matchInfoImage = paperCupMatchImg;
                      matchInfoString1 =
                        "Coffee cups can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case paperTowelsMatchImg:
                      matchInfoImage = paperTowelsMatchImg;
                      matchInfoString1 =
                        "Paper towels can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case plasticBagMatchImg:
                      matchInfoImage = plasticBagMatchImg;
                      matchInfoString1 =
                        "Plastic bags should be placed in the trash.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case strawAndLidMatchImg:
                      matchInfoImage = strawAndLidMatchImg;
                      matchInfoString1 =
                        "Plastic straws and disposable cup lids can be";
                      matchInfoString2 = "recycled with other plastics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1 + " " + matchInfoString2)
                      break;
                    case coffeeLidMatchImg:
                      matchInfoImage = coffeeLidMatchImg;
                      matchInfoString1 =
                        "Disposable plastic coffee cup lids can be recycled";
                      matchInfoString2 = "with other plastics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1 + " " + matchInfoString2)
                      break;
                    case appleMatchImg:
                      matchInfoImage = appleMatchImg;
                      matchInfoString1 =
                        "Apple cores can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case glassJarMatchImg:
                      matchInfoImage = glassJarMatchImg;
                      matchInfoString1 = 
                        "Glass food jars can be recycled.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case mailMatchImg:
                      matchInfoImage = mailMatchImg;
                      matchInfoString1 =
                        "Mail can be recycled with other papers.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case petWasteMatchImg:
                      matchInfoImage = petWasteMatchImg;
                      matchInfoString1 =
                        "Pet waste should be placed in the trash.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case paperPlatesMatchImg:
                      matchInfoImage = paperPlatesMatchImg;
                      matchInfoString1 =
                        "Paper plates can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case takeOutBoxMatchImg:
                      matchInfoImage = takeOutBoxMatchImg;
                      matchInfoString1 =
                        "Chopsticks and take-out food boxes can be composted";
                      matchInfoString2 = "with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1 + " " + matchInfoString2)
                      break;
                    case bonesMatchImg:
                      matchInfoImage = bonesMatchImg;
                      matchInfoString1 =
                        "Meat and bones can be composted with other organics.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case milkCartonMatchImg:
                      matchInfoImage = milkCartonMatchImg;
                      matchInfoString1 =
                        "Milk cartons can be composted with other organics.";
                      updateAltText(matchInfoString1)
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case paperBagMatchImg:
                      matchInfoImage = paperBagMatchImg;
                      matchInfoString1 =
                        "Paper bags can be recycled with other papers.";
                      updateAltText(matchInfoString1)
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case sodaCanMatchImg:
                      matchInfoImage = sodaCanMatchImg;
                      matchInfoString1 =
                        "Aluminum cans may be recycled with other metals.";
                      updateAltText(matchInfoString1)
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1)
                      matchInfoString2 = "";
                      break;
                    case brokenPlateMatchImg:
                      matchInfoImage = brokenPlateMatchImg;
                      matchInfoString1 =
                        "Broken dishes and glassware should be placed in";
                      matchInfoString2 = "the trash.";
                      updateAltText(`You have matched the ${tiles[firstFlippedTileIndex].image.alt}'s. Fact:` + matchInfoString1 + " " + matchInfoString2)
                      break;
                    default:
                      updateAltText('You have matched the ${tiles[index].image.alt}\'s.');
                  }

                  displayMatchInfo = true;

                  score += 50;



                  if (score != (tiles.length * 50) / 2) {
                    timer.matchDelay();
                  } else {
                    timer.endDelay();
                  }
                } else {
                  // Display Alt text where you failed to match the correct tiles
                  updateAltText(`You tried matching ${tiles[firstFlippedTileIndex].image.alt} and ${tiles[secondFlippedTileIndex].image.alt}`)
                  if (!muted) {
                    tileFlipSound.load();
                    tileFlipSound.play();
                  }

                  timer.missDelay();
                }
              }
            }
          }

          if (pauseButton.clicked(x, y) && score != (tiles.length * 50) / 2) {
            if (
              !timer.isPaused() &&
              !timer.isMatchDelayed() &&
              !timer.isEndDelayed()
            ) {
              if (!muted) {
                buttonSound.load();
                buttonSound.play();
              }

              timer.pause();
              pauseButton.image = playButtonImg;
              pauseButton.x =
                canvas.width / 2 -
                originalPlayButtonSize * 2 -
                originalPlayButtonSize / 4;
              pauseButton.y =
                canvas.height / 2 -
                originalPlayButtonSize / 2 -
                originalPlayButtonSize / 8;
            } else if (!timer.isMatchDelayed() && !timer.isEndDelayed()) {
              if (!muted) {
                buttonSound.load();
                buttonSound.play();
              }

              timer.unpause();
              pauseButton.image = pauseButtonImg;
              pauseButton.x = canvas.width - originalPlayButtonSize * 2;
              pauseButton.y = canvas.height - originalPlayButtonSize - 15;
            }
          }

          if (restartButton.clicked(x, y) && timer.isPaused()) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();

              matchingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
            }

            currentState = state.MATCHLEVEL;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
          }

          if (homeButton.clicked(x, y) && timer.isPaused()) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();

              matchingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
            }

            currentState = state.CHOOSEGAME;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
          }
        } else if (currentState == state.SORTINTRO1) {
          if (playButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.SORTINTRO2;

            updateAltText("Sort the falling waste into the correct bin. See how much waste you can keep out of the landfill.")

            playButton.x = canvas.width / 2 - originalPlayButtonSize / 2;
            playButton.y = canvas.height / 2 - originalPlayButtonSize / 4;
            playButton.size = originalPlayButtonSize;
            currentPlayButtonSize = originalPlayButtonSize;
            increasePlayButtonSize = true;
          }

          toggleAudio(x, y);
        } else if (currentState == state.SORTINTRO2) {
          if (playButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.SORTLEVEL;

            updateAltText("Select a level to start the game!")

            level1Button.x = canvas.width / 8;
            level1Button.y = canvas.height / 2 - levelButtonHeight / 2;
            level2Button.x = canvas.width / 8 + levelButtonWidth * (3 / 2);
            level2Button.y = canvas.height / 2 - levelButtonHeight / 2;
            level3Button.x = canvas.width / 8 + levelButtonWidth * 3;
            level3Button.y = canvas.height / 2 - levelButtonHeight / 2;
          }

          toggleAudio(x, y);
        } else if (currentState == state.SORTLEVEL) {
          if (
            level1Button.clicked(x, y) ||
            level2Button.clicked(x, y) ||
            level3Button.clicked(x, y)
          ) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            if (level1Button.clicked(x, y)) {
              level = 1;
            }

            if (level2Button.clicked(x, y)) {
              level = 2;
            }

            if (level3Button.clicked(x, y)) {
              level = 3;
            }

            setSortLevelBoard();

            currentState = state.PLAYSORT;

            updateAltText("4 recycling bins at the bottom of the screen in the order of Paper, Pastic Glass and Metal, Organics, and Landfill")

            pauseButton.image = pauseButtonImg;
            pauseButton.x = sidebarLocalXOrigin + binWidth * (1 / 8);
            pauseButton.y = canvas.height * (7 / 16);
            pauseButton.size = sortButtonSize;

            muteButton.x = sidebarLocalXOrigin + binWidth * (9 / 16);
            muteButton.y = canvas.height * (7 / 16);
            muteButton.size = sortButtonSize;

            homeButton.x =
              canvas.width / 2 -
              originalPlayButtonSize * 2 -
              originalPlayButtonSize / 4;
            homeButton.y = canvas.height / 2 + originalPlayButtonSize / 2;
            homeButton.size = originalPlayButtonSize;

            restartButton.x =
              canvas.width / 2 -
              originalPlayButtonSize +
              originalPlayButtonSize / 8;
            restartButton.y =
              canvas.height / 2 -
              originalPlayButtonSize / 2 -
              originalPlayButtonSize / 8;
            restartButton.size = originalPlayButtonSize;

            if (!muted) {
              backgroundMusic.pause();
              sortingMusic.currentTime = 0;
              sortingMusic.play();
            }

            timer.setTimerTime(timerTime);
            timer.start();
          }

          toggleAudio(x, y);
        } else if (currentState == state.PLAYSORT) {
          if (itemsRemaining >= 1) {
            toggleAudio(x, y);
          }

          if (pauseButton.clicked(x, y) && itemsRemaining >= 1) {
            if (!timer.isPaused()) {
              if (!muted) {
                buttonSound.load();
                buttonSound.play();
              }

              timer.pause();

              pauseButton.image = playButtonImg;
              pauseButton.x =
                canvas.width / 2 -
                originalPlayButtonSize * 2 -
                originalPlayButtonSize / 4;
              pauseButton.y =
                canvas.height / 2 -
                originalPlayButtonSize / 2 -
                originalPlayButtonSize / 8;
              pauseButton.size = originalPlayButtonSize;
            } else {
              if (!muted) {
                buttonSound.load();
                buttonSound.play();
              }

              timer.unpause();

              pauseButton.image = pauseButtonImg;
              pauseButton.x = sidebarLocalXOrigin + binWidth * (1 / 8);
              pauseButton.y = canvas.height * (7 / 16);
              pauseButton.size = sortButtonSize;
            }
          }

          if (restartButton.clicked(x, y) && timer.isPaused()) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();

              sortingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
            }

            currentState = state.SORTLEVEL;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
          }

          if (homeButton.clicked(x, y) && timer.isPaused()) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();

              sortingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
            }

            currentState = state.CHOOSEGAME;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
          }
        } else if (currentState == state.END) {
          if (restartButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            if (gameTitle == "matching") {
              currentState = state.MATCHLEVEL;
            } else {
              currentState = state.SORTLEVEL;
            }
          }

          if (homeButton.clicked(x, y)) {
            if (!muted) {
              buttonSound.load();
              buttonSound.play();
            }

            currentState = state.CHOOSEGAME;
          }

          toggleAudio(x, y);
        }
      }


    var helpCanvas = document.getElementById("helpCanvas");
    var helpCtx = helpCanvas.getContext("2d");
    function drawHelpPanel() {
      helpCtx.clearRect(0, 0, helpCanvas.width, helpCanvas.height);

      helpCtx.fillStyle = "white";
      helpCtx.textAlign = "left";

      helpCtx.font = "28px Arial";
      helpCtx.fillText("HELP & CONTROLS", 20, 40);

      helpCtx.font = "20px Arial";

      let lines = [
          "ENTER  Continue / Select",
          "BACKSPACE  Go Back",
          "M  Mute / Unmute Volume",
          "H  Open/Close Help Menu",
          "",
          "ZERO WASTE MATCHING:",
          "Arrows  Move",
          "Space/Enter  Flip card",
          "T - Pause/Unpause Timer",
          "P  Pause Game",

          "",
          "ZERO WASTE SORTING:",
          "1,2,3,4  Choose bin",
          "TAB  Cycle falling items",
          "T - Pause/Unpause Timer",
          "P  Pause Game",

          
          
      ];

      let y = 80;
      for (let i = 0; i < lines.length; i++) {
        helpCtx.fillText(lines[i], 20, y);
        y += 30;
      }
    }
      function mouseDownHandler(e) {
        var x = e.pageX - canvas.offsetLeft;
        var y = e.pageY - canvas.offsetTop;

        if (currentState == state.PLAYSORT) {
          for (i = garbage.length - 1; i >= 0; i--) {
            if (
              garbage[i].clicked(x, y) &&
              !mouseDown &&
              garbage[i].y + garbageSize <
                canvas.height - binFrontHeight + fallSpeed
            ) {
              dragImg = garbage[i].image;

              draggedGarbage = garbage[i];

              updateAltText(`Selected a ${dragImg.alt}`)

              switch (garbage[i].image) {
                case bananaMatchImg:
                  draggedGarbage.image = bananaGSImg;
                  break;
                case bottleMatchImg:
                  draggedGarbage.image = bottleGSImg;
                  break;
                case chipsMatchImg:
                  draggedGarbage.image = chipsGSImg;
                  break;
                case newsPaperMatchImg:
                  draggedGarbage.image = newsPaperGSImg;
                  break;
                case sodaCanMatchImg:
                  draggedGarbage.image = sodaCanGSImg;
                  break;
                case appleMatchImg:
                  draggedGarbage.image = appleGSImg;
                  break;
                case brokenPlateMatchImg:
                  draggedGarbage.image = brokenPlateGSImg;
                  break;
                case canMatchImg:
                  draggedGarbage.image = canGSImg;
                  break;
                case cardboardMatchImg:
                  draggedGarbage.image = cardboardGSImg;
                  break;
                case cerealMatchImg:
                  draggedGarbage.image = cerealGSImg;
                  break;
                case diaperMatchImg:
                  draggedGarbage.image = diaperGSImg;
                  break;
                case glassBottleMatchImg:
                  draggedGarbage.image = glassBottleGSImg;
                  break;
                case glassJarMatchImg:
                  draggedGarbage.image = glassJarGSImg;
                  break;
                case grassMatchImg:
                  draggedGarbage.image = grassGSImg;
                  break;
                case leafMatchImg:
                  draggedGarbage.image = leafGSImg;
                  break;
                case papersMatchImg:
                  draggedGarbage.image = papersGSImg;
                  break;
                case mailMatchImg:
                  draggedGarbage.image = mailGSImg;
                  break;
                case plasticBagMatchImg:
                  draggedGarbage.image = plasticBagGSImg;
                  break;
                case pumpkinMatchImg:
                  draggedGarbage.image = pumpkinGSImg;
                  break;
                case styrofoamMatchImg:
                  draggedGarbage.image = styrofoamGSImg;
                  break;
                case milkCartonMatchImg:
                  draggedGarbage.image = milkGSImg;
                  break;
                case juiceMatchImg:
                  draggedGarbage.image = juiceGSImg;
                  break;
                case eggsMatchImg:
                  draggedGarbage.image = eggsGSImg;
                  break;
                case strawAndLidMatchImg:
                  draggedGarbage.image = strawGSImg;
                  break;
                case takeOutBoxMatchImg:
                  draggedGarbage.image = chineseGSImg;
                  break;
                case stickMatchImg:
                  draggedGarbage.image = stickGSImg;
                  break;
                case candyMatchImg:
                  draggedGarbage.image = candyGSImg;
                  break;
                case petWasteMatchImg:
                  draggedGarbage.image = poopGSImg;
                  break;
                case paperRollMatchImg:
                  draggedGarbage.image = paperRollGSImg;
                  break;
                case paperBagMatchImg:
                  draggedGarbage.image = paperBagGSImg;
                  break;
                case aluminumFoilMatchImg:
                  draggedGarbage.image = aluminumFoilGSImg;
                  break;
                case coffeeLidMatchImg:
                  draggedGarbage.image = coffeeLidGSImg;
                  break;
                default:
                //do nothing
              }

              dragOffsetX = garbage[i].x - x;
              dragOffsetY = garbage[i].y - y;

              dragX = x + dragOffsetX;
              dragY = y + dragOffsetY;

              garbage.splice(i, 1);

              mouseDown = true;
            }
          }
        }
      }

      function mouseMoveHandler(e) {
        var x = e.pageX - canvas.offsetLeft;
        var y = e.pageY - canvas.offsetTop;

        if (currentState == state.PLAYSORT) {
          if (mouseDown) {
            dragX = x + dragOffsetX;
            dragY = y + dragOffsetY;
          }
        }
      }

      function mouseUpHandler(e) {
        if (currentState == state.PLAYSORT) {
          if (mouseDown) {
            var validPlacement = true;

            var tempX = draggedGarbage.x;
            var tempY = draggedGarbage.y;

            draggedGarbage.x = dragX;
            draggedGarbage.y = dragY;

            for (i = 0; i < garbage.length; i++) {
              if (
                draggedGarbage.isColliding(garbage[i]) &&
                draggedGarbage.y + draggedGarbage.size <
                  canvas.height - binFrontHeight
              ) {
                validPlacement = false;
              }
            }

            if (
              dragY < 0 ||
              dragX < 0 ||
              dragX + garbageSize > canvas.width - binWidth ||
              (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX < paperColumnStart &&
                draggedGarbage.type == paper) ||
              (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX + garbageSize > paperColumnEnd &&
                draggedGarbage.type == paper) ||
              (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX < comingledColumnStart &&
                draggedGarbage.type == comingled) ||
              (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX + garbageSize > comingledColumnEnd &&
                draggedGarbage.type == comingled) ||
              (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX < organicsColumnStart &&
                draggedGarbage.type == organics) ||
              (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX + garbageSize > organicsColumnEnd &&
                draggedGarbage.type == organics) ||
              (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX < landfillColumnStart &&
                draggedGarbage.type == landfill) ||
              (dragY + garbageSize > canvas.height - binFrontHeight &&
                dragX + garbageSize > landfillColumnEnd &&
                draggedGarbage.type == landfill)
            ) {
              validPlacement = false;
            }

            if (validPlacement) {
              draggedGarbage.image = dragImg;
              garbage.push(draggedGarbage);
            } else {
              draggedGarbage.image = dragImg;
              draggedGarbage.x = tempX;
              draggedGarbage.y = tempY;
              garbage.push(draggedGarbage);
            }
          }
        }

        mouseDown = false;
      }

      //remap touch event as mouse event
      function touch2Mouse(e) {
        var theTouch = e.changedTouches[0];
        var mouseEv;

        switch (e.type) {
          case "touchstart":
            mouseEv = "mousedown";
            break;
          case "touchend":
            mouseEv = "mouseup";
            break;
          case "touchmove":
            mouseEv = "mousemove";
            break;
          default:
            return;
        }

        var mouseEvent = document.createEvent("MouseEvent");
        mouseEvent.initMouseEvent(
          mouseEv,
          true,
          true,
          window,
          1,
          theTouch.screenX,
          theTouch.screenY,
          theTouch.clientX,
          theTouch.clientY,
          false,
          false,
          false,
          false,
          0,
          null
        );
        theTouch.target.dispatchEvent(mouseEvent);
        //prevent activating multiple events at once
        e.preventDefault();
      }

      function toggleAudio(x, y) {
        if (muteButton.clicked(x, y) && !muted) {
          if (currentState == state.PLAYMATCH) {
            matchingMusic.pause();
            updateAltText("Muted matching music");
          } else if (currentState == state.PLAYSORT) {
            sortingMusic.pause();
            updateAltText("Muted matching music");
          } else {
            backgroundMusic.pause();
            updateAltText("Muted background music");
          }

          muted = true;
          muteButton.image = unmuteImg;
        } else if (muteButton.clicked(x, y) && muted) {
          if (currentState == state.PLAYMATCH) {
            matchingMusic.play();
            updateAltText("Unmuted matching music");
          } else if (currentState == state.PLAYSORT) {
            sortingMusic.play();
            updateAltText("Unmuted sorting music");
          } else {
            backgroundMusic.play();
            updateAltText("Unmuted background music");
          }

          muted = false;
          muteButton.image = muteImg;
        }

      }

      function drawGameBoard() {
        ctx.beginPath();
        ctx.rect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#FCE21E";
        ctx.fill();
        ctx.closePath();
      }

      function drawMatchInfo() {
        ctx.drawImage(matchInfoImage, 90, canvas.height - 115, 100, 100);
        ctx.drawImage(
        helpButton.image,
        helpButton.x,
        helpButton.y,
        helpButton.size,
        helpButton.size
    );

        ctx.font = "20px Comic Sans MS";
        ctx.fillStyle = "#000000";
        ctx.textAlign = "left";
        ctx.textBaseline = "middle";
        ctx.fillText(matchInfoString1, 210, canvas.height - 75);
        ctx.fillText(matchInfoString2, 210, canvas.height - 50);
      }

      function drawScore() {
        ctx.font = "bold 48px Comic Sans MS";
        ctx.fillStyle = "#201A91";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(
          "Score: " + score,
          canvas.width / 2,
          tileOffsetTop / 2 + 10
        );
      }

      function drawTiles() {
        for (i = 0; i < tiles.length; i++) {
          if (tiles[i].flipped || tiles[i].matched) {
            ctx.drawImage(
              cardFrontImg,
              tiles[i].x,
              tiles[i].y,
              tiles[i].size,
              tiles[i].size
            );

            var borderSize = tiles[i].size * (7 / 8);
            ctx.drawImage(
              tiles[i].image,
              tiles[i].x + borderSize,
              tiles[i].y + borderSize,
              tiles[i].size - borderSize * 2,
              tiles[i].size - borderSize * 2
            );
          } else {
            ctx.drawImage(
              matchingCardImg,
              tiles[i].x,
              tiles[i].y,
              tiles[i].size,
              tiles[i].size
            );
          }
        }
      }

      function drawLoadingScreen() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.drawImage(loadingImg, 0, 0, canvas.width, canvas.height);

        drawEmptyLoadingBar();
        drawLoadingBar();

        if (numberLoaded >= numberOfAssets) {
          currentState = state.MAININTRO;
          backgroundMusic.play();
        }
      }

      function drawEmptyLoadingBar() {
        ctx.beginPath();
        ctx.rect(0, canvas.height / 2, canvas.width, canvas.height / 20);
        ctx.fillStyle = "#999";
        ctx.fill();
        ctx.closePath();
      }

      function drawLoadingBar() {
        ctx.beginPath();
        ctx.rect(
          0,
          canvas.height / 2,
          canvas.width * (numberLoaded / numberOfAssets),
          canvas.height / 20
        );
        ctx.fillStyle = "#0F0";
        ctx.fill();
        ctx.closePath();
      }

      function drawMainIntroScreen() {
        ctx.fillStyle = "red";
        ctx.fillRect(helpButton.x, helpButton.y, helpButton.size, helpButton.size);
        ctx.drawImage(mainIntroImg, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          playButton.image,
          playButton.x,
          playButton.y,
          playButton.size,
          playButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawWelcome1Screen() {
        ctx.drawImage(welcome1Img, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          playButton.image,
          playButton.x,
          playButton.y,
          playButton.size,
          playButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawWelcome2Screen() {
        ctx.drawImage(welcome2Img, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          playButton.image,
          playButton.x,
          playButton.y,
          playButton.size,
          playButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawChooseGameScreen() {
        ctx.drawImage(chooseGameImg, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          matchingButton.image,
          matchingButton.x,
          matchingButton.y,
          matchingButton.width,
          matchingButton.height
        );
        ctx.drawImage(
          sortingButton.image,
          sortingButton.x,
          sortingButton.y,
          sortingButton.width,
          sortingButton.height
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawMatchingIntro1() {
        ctx.drawImage(matchingIntro1Img, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          playButton.image,
          playButton.x,
          playButton.y,
          playButton.size,
          playButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawMatchingIntro2() {
        ctx.drawImage(matchingIntro2Img, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          playButton.image,
          playButton.x,
          playButton.y,
          playButton.size,
          playButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawMatchingIntro3() {
        ctx.drawImage(matchingIntro3Img, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          playButton.image,
          playButton.x,
          playButton.y,
          playButton.size,
          playButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawMatchingChooseLevelScreen() {
        ctx.drawImage(
          matchingLevelSelectImg,
          0,
          0,
          canvas.width,
          canvas.height
        );
        ctx.drawImage(
          level1Button.image,
          level1Button.x,
          level1Button.y,
          level1Button.width,
          level1Button.height
        );
        ctx.drawImage(
          level2Button.image,
          level2Button.x,
          level2Button.y,
          level2Button.width,
          level2Button.height
        );
        ctx.drawImage(
          level3Button.image,
          level3Button.x,
          level3Button.y,
          level3Button.width,
          level3Button.height
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawSortingChooseLevelScreen() {
        ctx.drawImage(sortingLevelSelectImg, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          level1Button.image,
          level1Button.x,
          level1Button.y,
          level1Button.width,
          level1Button.height
        );
        ctx.drawImage(
          level2Button.image,
          level2Button.x,
          level2Button.y,
          level2Button.width,
          level2Button.height
        );
        ctx.drawImage(
          level3Button.image,
          level3Button.x,
          level3Button.y,
          level3Button.width,
          level3Button.height
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawSortingIntro1() {
        ctx.drawImage(sortingIntro1Img, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          playButton.image,
          playButton.x,
          playButton.y,
          playButton.size,
          playButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawSortingIntro2() {
        ctx.drawImage(sortingIntro2Img, 0, 0, canvas.width, canvas.height);
        ctx.drawImage(
          playButton.image,
          playButton.x,
          playButton.y,
          playButton.size,
          playButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawEndGameScreen() {
        if (gameTitle == "matching") {
          ctx.drawImage(
            endScreenMatchingImg,
            0,
            0,
            canvas.width,
            canvas.height
          );
          ctx.font = "bold 48px Comic Sans MS";
          ctx.fillStyle = "#201A91";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(score, canvas.width / 2 - 150, canvas.height / 2);
        } else {
          ctx.drawImage(endScreenSortingImg, 0, 0, canvas.width, canvas.height);
          ctx.font = "bold 28px Comic Sans MS";
          ctx.fillStyle = "#201A91";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(
            recyclingSorted +
              landfillSorted +
              " of " +
              startingGarbageCount +
              " items sorted correctly",
            canvas.width / 2 - 150,
            canvas.height / 2
          );
        }

        ctx.drawImage(
          restartButton.image,
          restartButton.x,
          restartButton.y,
          restartButton.size,
          restartButton.size
        );
        ctx.drawImage(
          homeButton.image,
          homeButton.x,
          homeButton.y,
          homeButton.size,
          homeButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);

      }

      function drawPauseButton() {
        ctx.drawImage(
          pauseButton.image,
          pauseButton.x,
          pauseButton.y,
          pauseButton.size,
          pauseButton.size
        );
      }

      function drawMuteButton() {
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
      }

      function drawEmptyBar() {
        ctx.beginPath();
        ctx.rect(0, 0, canvas.width, timerBarHeight);
        ctx.fillStyle = "#00FF00";
        ctx.fill();
        ctx.closePath();
      }

      function drawTimerBar() {
        ctx.beginPath();
        ctx.rect(0, 0, timerBarWidth, timerBarHeight);
        ctx.fillStyle = "#FF0000";
        ctx.fill();
        ctx.closePath();
      }

      function drawTime() {
        ctx.font = "bold 16px Comic Sans MS";
        ctx.fillStyle = "#000000";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(timeElapsed, 30, canvas.height - 20);
      }

      function drawPauseScreen() {
        ctx.drawImage(pauseScreenImg, 0, 0, canvas.width, canvas.height);

        ctx.drawImage(
          pauseButton.image,
          pauseButton.x,
          pauseButton.y,
          pauseButton.size,
          pauseButton.size
        );
        ctx.drawImage(
          restartButton.image,
          restartButton.x,
          restartButton.y,
          restartButton.size,
          restartButton.size
        );
        ctx.drawImage(
          homeButton.image,
          homeButton.x,
          homeButton.y,
          homeButton.size,
          homeButton.size
        );
        ctx.drawImage(
          muteButton.image,
          muteButton.x,
          muteButton.y,
          muteButton.size,
          muteButton.size
        );
      }

      function hideMuteIcon() {
        showMuteButton = false;
        const volumeBox = document.getElementById("volumeBox");
        if (volumeBox) volumeBox.style.display = "none";
        if (typeof muteButton !== "undefined") {
          muteButton.x = -9999; // move it far offscreen
          muteButton.y = -9999;
  }
}
      function toggleHelpMenu() {
        const helpCanvas = document.getElementById("helpCanvas");

        if (helpCanvas.style.display === "none") {
            helpCanvas.style.display = "block";
            drawHelpPanel();
            updateAltText("Help menu opened.");
        } else {
            helpCanvas.style.display = "none";
            updateAltText("Help menu closed.");
        }
    }
      function drawSortingGame() {
        ctx.drawImage(sortingBackgroundImg, 0, 0, canvas.width, canvas.height);

        ctx.drawImage(
          paperBackImg,
          paperColumnStart,
          canvas.height - binFrontHeight - binBackHeight,
          binWidth,
          binBackHeight
        );
        ctx.drawImage(
          comingledBackImg,
          comingledColumnStart,
          canvas.height - binFrontHeight - binBackHeight,
          binWidth,
          binBackHeight
        );
        ctx.drawImage(
          organicsBackImg,
          organicsColumnStart,
          canvas.height - binFrontHeight - binBackHeight,
          binWidth,
          binBackHeight
        );
        ctx.drawImage(
          landfillBackImg,
          landfillColumnStart,
          canvas.height - binFrontHeight - binBackHeight,
          binWidth,
          binBackHeight
        );

        for (i = 0; i < garbage.length; i++) {
          ctx.drawImage(
            garbage[i].image,
            garbage[i].x,
            garbage[i].y,
            garbage[i].size,
            garbage[i].size
          );
        }

        drawGarbageHighLight();

        if (mouseDown) {
          ctx.drawImage(
            draggedGarbage.image,
            draggedGarbage.x,
            draggedGarbage.y,
            draggedGarbage.size,
            draggedGarbage.size
          );
          ctx.drawImage(dragImg, dragX, dragY, garbageSize, garbageSize);
        }

        ctx.drawImage(
          paperFrontImg,
          paperColumnStart,
          canvas.height - binFrontHeight,
          binWidth,
          binFrontHeight
        );
        ctx.drawImage(
          comingledFrontImg,
          comingledColumnStart,
          canvas.height - binFrontHeight,
          binWidth,
          binFrontHeight
        );
        ctx.drawImage(
          organicsFrontImg,
          organicsColumnStart,
          canvas.height - binFrontHeight,
          binWidth,
          binFrontHeight
        );
        ctx.drawImage(
          landfillFrontImg,
          landfillColumnStart,
          canvas.height - binFrontHeight,
          binWidth,
          binFrontHeight
        );

        drawSidebar();
      }

      function drawSidebar() {
        //sidebar background
        ctx.beginPath();
        ctx.rect(binWidth * 4, 0, binWidth, canvas.height);
        ctx.fillStyle = "#83ccee";
        ctx.fill();
        ctx.closePath();

        //"Time Remaining" text
        ctx.font = "25px Comic Sans MS";
        ctx.fillStyle = "black";
        ctx.textAlign = "center";
        ctx.fillText(
          "Time",
          sidebarLocalXOrigin + binWidth * (4 / 8),
          canvas.height * (1 / 8) - 20
        );
        ctx.fillText(
          "Remaining",
          sidebarLocalXOrigin + binWidth * (4 / 8),
          canvas.height * (1 / 8) + 10
        );

        //yellow box that contains "Score:"
        ctx.beginPath();
        ctx.rect(
          sidebarLocalXOrigin + binWidth * (1 / 8),
          canvas.height * (3 / 4) - 80,
          binWidth * (3 / 4),
          60
        );
        ctx.fillStyle = "#f4c831";
        ctx.fill();
        ctx.closePath();
        ctx.font = "25px Comic Sans MS";
        ctx.fillStyle = "black";
        ctx.textAlign = "center";
        ctx.fillText(
          "Score",
          sidebarLocalXOrigin + binWidth * (4 / 8),
          canvas.height * (3 / 4) - 42
        );

        //white box that surrounds the percentage score
        ctx.beginPath();
        ctx.rect(
          sidebarLocalXOrigin + binWidth * (2 / 8),
          canvas.height * (3 / 4),
          binWidth / 2,
          50
        );
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.closePath();

        //the percentage text
        ctx.font = "25px Comic Sans MS";
        ctx.fillStyle = "black";
        ctx.textAlign = "center";
        ctx.fillText(
          scorePercentage + "%",
          sidebarLocalXOrigin + binWidth * (4 / 8),
          canvas.height * (3 / 4) + 35
        );

        //percentage description text
        ctx.font = "25px Comic Sans MS";
        ctx.fillStyle = "black";
        ctx.textAlign = "center";
        ctx.fillText(
          "Diverted from",
          sidebarLocalXOrigin + binWidth * (4 / 8),
          canvas.height * (7 / 8) + 15
        );
        ctx.fillText(
          "the landfill",
          sidebarLocalXOrigin + binWidth * (4 / 8),
          canvas.height * (7 / 8) + 50
        );

        drawEmptyCircle();
        drawFilledCircle();
      }

      function drawEmptyCircle() {
        ctx.beginPath();
        ctx.arc(
          sidebarLocalXOrigin + binWidth / 2,
          canvas.height / 4 + timerCircleRadius / 2,
          timerCircleRadius,
          0,
          Math.PI * 2
        );
        ctx.fillStyle = "#F4C831";
        ctx.fill();
        ctx.closePath();
      }

      function drawFilledCircle() {
        ctx.beginPath();
        ctx.moveTo(
          sidebarLocalXOrigin + binWidth / 2,
          canvas.height / 4 + timerCircleRadius / 2
        );
        ctx.arc(
          sidebarLocalXOrigin + binWidth / 2,
          canvas.height / 4 + timerCircleRadius / 2,
          timerCircleRadius,
          startAngle,
          endAngle
        );
        ctx.fillStyle = "#FFFFFF";
        ctx.fill();
        ctx.closePath();
      }

      function changeChooseButtonSize() {
        if (chooseButtonSize < 250 && increaseChooseButtonSize) {
          chooseButtonSize += 0.2; 
          matchingButton.x -= 0.1; 
          matchingButton.y -= 0.1;
          matchingButton.width = chooseButtonSize;
          matchingButton.height = chooseButtonSize;
          sortingButton.x -= 0.1; 
          sortingButton.y -= 0.1; 
          sortingButton.width = chooseButtonSize;
          sortingButton.height = chooseButtonSize;
          if (chooseButtonSize >= 250) {
            increaseChooseButtonSize = false;
          }
        } else {
          chooseButtonSize -= 0.2; 
          matchingButton.x += 0.1; 
          matchingButton.y += 0.1;
          matchingButton.width = chooseButtonSize;
          matchingButton.height = chooseButtonSize;
          sortingButton.x += 0.1; 
          sortingButton.y += 0.1;
          sortingButton.width = chooseButtonSize;
          sortingButton.height = chooseButtonSize;
          if (chooseButtonSize <= 200) {
            increaseChooseButtonSize = true;
          }
        }
      }

      function changePlayButtonSize() {
        if (currentPlayButtonSize < 125 && increasePlayButtonSize) {
          currentPlayButtonSize += 0.1;
          playButton.x -= 0.05; 
          playButton.y -= 0.05; 
          playButton.size = currentPlayButtonSize;
          if (currentPlayButtonSize >= 125) {
            increasePlayButtonSize = false;
          }
        } else {
          currentPlayButtonSize -= 0.1; 
          playButton.x += 0.05; 
          playButton.y += 0.05;
          playButton.size = currentPlayButtonSize;
          if (currentPlayButtonSize <= 100) {
            increasePlayButtonSize = true;
          }
        }
      }

      function changeLevelButtonSize() {
        if (levelButtonWidth < 150 && increaseLevelButtonSize) {
          levelButtonWidth += 0.1;
          levelButtonHeight += 0.1;
          level1Button.x -= 0.05;
          level1Button.y -= 0.05;
          level1Button.width = levelButtonWidth;
          level1Button.height = levelButtonHeight;
          level2Button.x -= 0.05;
          level2Button.y -= 0.05;
          level2Button.width = levelButtonWidth;
          level2Button.height = levelButtonHeight;
          level3Button.x -= 0.05;
          level3Button.y -= 0.05;
          level3Button.width = levelButtonWidth;
          level3Button.height = levelButtonHeight;
          if (levelButtonWidth >= 150) {
            increaseLevelButtonSize = false;
          }
        } else {
          levelButtonWidth -= 0.1; 
          levelButtonHeight -= 0.1; 
          level1Button.x += 0.05; 
          level1Button.y += 0.05; 
          level1Button.width = levelButtonWidth;
          level1Button.height = levelButtonHeight;
          level2Button.x += 0.05; 
          level2Button.y += 0.05; 
          level2Button.width = levelButtonWidth;
          level2Button.height = levelButtonHeight;
          level3Button.x += 0.05; 
          level3Button.y += 0.05; 
          level3Button.width = levelButtonWidth;
          level3Button.height = levelButtonHeight;
          if (levelButtonWidth <= 125) {
            increaseLevelButtonSize = true;
          }
        }
      }

      function changeRestartAndHomeButtonSize() {
        if (currentPlayButtonSize < 125 && increasePlayButtonSize) {
          currentPlayButtonSize += 0.5;

          restartButton.x -= 0.25;
          restartButton.y -= 0.25;

          restartButton.size = currentPlayButtonSize;
          homeButton.x -= 0.25;
          homeButton.y -= 0.25;
        
          homeButton.size = currentPlayButtonSize;

          if (currentPlayButtonSize >= 125) {
            increasePlayButtonSize = false;
          }
        } else {
          currentPlayButtonSize -= 0.5;

          restartButton.x += 0.25;
          restartButton.y += 0.25;

          restartButton.size = currentPlayButtonSize;
          homeButton.x += 0.25;
          homeButton.y += 0.25;
          
          homeButton.size = currentPlayButtonSize;

          if (currentPlayButtonSize <= 100) {
            increasePlayButtonSize = true;
          }
        }
      }

      // Add to draw() function to show focus indicator
      function drawFocusIndicator(){
        if (keyboardNavigationActive && selectedTileIndex >= 0 && selectedTileIndex < tiles.length){
          const tile = tiles[selectedTileIndex];

          //draw border around tile
          ctx.strokeStyle = "#FF0000";
          ctx.lineWidth = 6;
          ctx.strokeRect(tile.x-3, tile.y-3, tile.size+6, tile.size+6);

          //add glow effect
          ctx.shadowColor = "#FF0000";
          ctx.shadowBlur = 15;
          ctx.strokeRect(tile.x-3, tile.y-3, tile.size+6, tile.size+6);
          ctx.shadowBlur = 0;
        }
      }

      function resetKeyBoardNavigation(){
        selectedTileIndex = -1;
        keyboardNavigationActive = false;
      }

      function drawGarbageHighLight(){
        if(selectedGarbageItem && currentState == state.PLAYSORT){
          ctx.strokeStyle = "#FF0000";
          ctx.lineWidth =4;
          ctx.strokeRect(selectedGarbageItem.x-5, selectedGarbageItem.y-5, selectedGarbageItem.size+10, selectedGarbageItem.size+10);

          ctx.shadowColor = "#FF0000";
          ctx.shadowBlur = 15;
          ctx.strokeRect(selectedGarbageItem.x-5, selectedGarbageItem.y-5, selectedGarbageItem.size+10, selectedGarbageItem.size+10);
          ctx.shadowBlur = 0;
        }
      }

      

      function draw() {

        if (currentState == state.LOADING) {
          drawLoadingScreen();
        } else if (currentState == state.MAININTRO) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawMainIntroScreen();

          changePlayButtonSize();
        } else if (currentState == state.WELCOME1) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawWelcome1Screen();

          changePlayButtonSize();
        } else if (currentState == state.WELCOME2) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawWelcome2Screen();

          changePlayButtonSize();
        } else if (currentState == state.CHOOSEGAME) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawChooseGameScreen();

          changeChooseButtonSize();
        } else if (currentState == state.MATCHINTRO1) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawMatchingIntro1();

          changePlayButtonSize();
        } else if (currentState == state.MATCHINTRO2) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawMatchingIntro2();

          changePlayButtonSize();
        } else if (currentState == state.MATCHINTRO3) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawMatchingIntro3();

          changePlayButtonSize();
        } else if (currentState == state.MATCHLEVEL) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawMatchingChooseLevelScreen();

          changeLevelButtonSize();
        } else if (currentState == state.SORTINTRO1) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawSortingIntro1();

          changePlayButtonSize();
        } else if (currentState == state.SORTINTRO2) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawSortingIntro2();

          changePlayButtonSize();
        } else if (currentState == state.SORTLEVEL) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawSortingChooseLevelScreen();

          changeLevelButtonSize();
        } else if (currentState == state.PLAYMATCH) {
           timer.update();

          if (
            !timer.isPaused() &&
            !timerFreeze &&
            !timer.isMatchDelayed() &&
            !timer.isEndDelayed()
          ) {
            percent = (timer.getRunTime() - tFrozenAccum) / timer.getTimerTime();

            timerBarWidth = percent * canvas.width;

            timeElapsed = Number((timer.getRunTime() - tFrozenAccum) / 1000).toFixed(2);
          }

          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawGameBoard();
          drawScore();
          
          drawEmptyBar();
          drawTimerBar();
          
    
          //drawTime();
          drawTiles();
          drawFocusIndicator()

          if (displayMatchInfo) {
            drawMatchInfo();
          }

          if (timer.isPaused()) {
            const btnSize = originalPlayButtonSize; 
            const gap = 15;
            
            const gridCX = (canvas.width / 2) - 100; 
            
            const gridCY = (canvas.height / 2) - 50; 

            pauseButton.x = gridCX - btnSize - gap;
            pauseButton.y = gridCY;
            pauseButton.size = btnSize;

            restartButton.x = gridCX + gap;
            restartButton.y = gridCY;
            restartButton.size = btnSize;

            homeButton.x = gridCX - btnSize - gap;
            homeButton.y = gridCY + btnSize + gap;
            homeButton.size = btnSize;

            muteButton.x = gridCX + gap;
            muteButton.y = gridCY + btnSize + gap;
            muteButton.size = btnSize;

            drawPauseScreen();
          } else {
            drawPauseButton();
            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 2;
            muteButton.size = soundButtonSize;
            drawMuteButton();
          }

          if (
            score == (tiles.length * 50) / 2 &&
            !timer.isMatchDelayed() &&
            !timer.isEndDelayed()
          ) {
            if (!muted) {
              matchingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
            }

            currentState = state.END;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
          }

          if (numberTilesFlipped == 2 && !timer.isMissDelayed()) {
            numberTilesFlipped = 0;
            tiles[firstFlippedTileIndex].flipped = false;
            tiles[secondFlippedTileIndex].flipped = false;
          }

          if (
            timer.getRunTime() > timer.getTimerTime() &&
            !timer.isPaused() &&
            !timer.isMatchDelayed() &&
            !timer.isEndDelayed()
          ) {
            if (!muted) {
              matchingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
            }

            currentState = state.END;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
          }
        } else if (currentState == state.PLAYSORT) {
          timer.update();
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          ctx.drawImage(sortingBackgroundImg, 0, 0, canvas.width, canvas.height);

          ctx.fillStyle = "black";
          ctx.font = "30px Verdana";
          ctx.fillText("Time: " + timeElapsed, canvas.width * 0.8, canvas.height * 0.1);
          ctx.fillText("Score: " + scorePercentage + "%", canvas.width * 0.8, canvas.height * 0.1 + 40);

          ctx.drawImage(paperBackImg, paperBinX, canvas.height - binBackHeight, binWidth, binBackHeight);
          ctx.drawImage(
            comingledBackImg,
            comingledBinX,
            canvas.height - binBackHeight,
            binWidth,
            binBackHeight
          );
          ctx.drawImage(
            organicsBackImg,
            organicsBinX,
            canvas.height - binBackHeight,
            binWidth,
            binBackHeight
          );
          ctx.drawImage(
            landfillBackImg,
            landfillBinX,
            canvas.height - binBackHeight,
            binWidth,
            binBackHeight
          );
          ctx.drawImage(
            helpButton.image,
            helpButton.x,
            helpButton.y,
            helpButton.size,
            helpButton.size
          );

          if(!timer.isPaused() && garbage.length>0){
            let isSelectedValid = selectedGarbageItem && garbage.includes(selectedGarbageItem) && (selectedGarbageItem.falling || (selectedGarbageItem.y + selectedGarbageItem.size <canvas.height -binFrontHeight));

            if(!isSelectedValid && selectionLocked){
              let sortableGarbage = garbage.filter(g => g.falling || (g.y + g.size < canvas.height - binFrontHeight));
              //selectedGarbageItem = null;
              if(sortableGarbage.length > 0){
                selectedGarbageItem = sortableGarbage[0];
                selectedSortableIndex = 0;
              } else {
                selectedGarbageItem = null;
                selectionLocked = false;
                selectedSortableIndex = -1;
              }
            } else if (!selectionLocked){
                for(let i=0; i<garbage.length; i++){
                  if(garbage[i].falling || (garbage[i].y + garbage[i].size < canvas.height - binFrontHeight)){
                    selectedGarbageItem = garbage[i];
                    selectedSortableIndex = i;
                    break;
            }
          }
        }
      } 
        
        if (isGameplayActive()) {
          // Keyboard control for active falling garbage
          let activeGarbage = garbage.find(g => g.falling);
        
          if (activeGarbage) {
            if (keys["ArrowLeft"]) {
            activeGarbage.moveLeft(canvas.width);
            updateAltText("Moved left")
          }
          if (keys["ArrowRight"]) {
            activeGarbage.moveRight(canvas.width);
            updateAltText("Moved right")
          }
          }
        }

          if (!timer.isPaused() && !timerFreeze) {
            percent = (timer.getRunTime() - tFrozenAccum) / timer.getTimerTime();

            endAngle = startAngle + percent * Math.PI * 2;

            timeElapsed = Number((timer.getRunTime() - tFrozenAccum) / 1000).toFixed(2);
          }

          //remove garbage that went into a bin and increase the score percentage
          for (i = garbage.length - 1; i >= 0; i--) {
            if (garbage[i].y > canvas.height - binFrontHeight) {
              if(selectedGarbageItem === garbage[i]){
                selectedGarbageItem = null;
                selectionLocked = false;
                selectedSortableIndex = -1;
              }

              if (!muted) {
                tileMatchSound.load();
                tileMatchSound.play();
              }

              if (garbage[i].type != landfill) {
                recyclingSorted++;
                scorePercentage = Number(
                  (recyclingSorted / startingGarbageCount) * 100
                ).toFixed(0);
              } else {
                landfillSorted++;
              }

              garbage.splice(i, 1);
              itemsRemaining--;

              if (itemsRemaining < 1) {
                timer.missDelay();
              }
            }
          }

          if (timer.getRunTime() > lastDropTime && garbageQueue.length > 0 &&!timer.isPaused()) {
            var newGarbage = garbageQueue.pop();
            garbage.push(newGarbage);
            garbageSelectionOrder.push(newGarbage);
            lastDropTime += dropGarbageInterval;
          }

          ctx.clearRect(0, 0, canvas.width, canvas.height);
       drawSortingGame();
          drawGarbageHighLight();
          // Update & draw all garbage
          garbage.forEach(g => {
            g.draw(ctx);
          });

          if (timer.isPaused()) {
            const btnSize = originalPlayButtonSize; 
            const gap = 15;
            
            const gridCX = (canvas.width / 2) - 100; 
            
            const gridCY = (canvas.height / 2) - 50;

            pauseButton.x = gridCX - btnSize - gap;
            pauseButton.y = gridCY;
            pauseButton.size = btnSize;

            restartButton.x = gridCX + gap;
            restartButton.y = gridCY;
            restartButton.size = btnSize;

            homeButton.x = gridCX - btnSize - gap;
            homeButton.y = gridCY + btnSize + gap;
            homeButton.size = btnSize;

            muteButton.x = gridCX + gap;
            muteButton.y = gridCY + btnSize + gap;
            muteButton.size = btnSize;


            drawPauseScreen();
          } else {
            pauseButton.x =
              sidebarLocalXOrigin + binWidth / 4 - sortButtonSize / 2;
            pauseButton.y = canvas.height * (7 / 16);
            pauseButton.size = sortButtonSize;
            drawPauseButton();
            muteButton.x = canvas.width - binWidth / 4 - sortButtonSize / 2;
            muteButton.y = canvas.height * (7 / 16);
            muteButton.size = sortButtonSize;
            drawMuteButton();
          }

          if (timer.getRunTime() > timer.getTimerTime() && !timer.isPaused()) {
            if (!muted) {
              sortingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
            }

            currentState = state.END;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
          }

          if (itemsRemaining < 1 && !timer.isMissDelayed()) {
            if (!muted) {
              sortingMusic.pause();
              backgroundMusic.currentTime = 0;
              backgroundMusic.play();
            }

            currentState = state.END;

            homeButton.x = canvas.width / 3 + originalPlayButtonSize / 2;
            homeButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            restartButton.x = canvas.width / 4 - originalPlayButtonSize / 2;
            restartButton.y =
              canvas.height / 2 +
              canvas.height / 4 -
              originalPlayButtonSize / 2;

            muteButton.x = canvas.width - soundButtonSize - soundButtonSize / 8;
            muteButton.y = soundButtonSize / 8;
            muteButton.size = soundButtonSize;
          }

          if (!timer.isPaused()) {
            for (i = 0; i < garbage.length; i++) {
              for (j = 0; j < garbage.length; j++) {
                if (i != j) {
                  if (
                    garbage[i].isColliding(garbage[j]) &&
                    garbage[i].y < garbage[j].y
                  ) {
                    garbage[i].falling = false;
                  }
                }
              }

              if (garbage[i].isColliding(draggedGarbage) && mouseDown) {
                garbage[i].falling = false;
              }

              if (
                garbage[i].y + garbage[i].size <
                canvas.height - binFrontHeight
              ) {
                if (garbage[i].falling) {
                  garbage[i].y += (fallSpeed - 1.5);
                }
              } else if (
                (garbage[i].x >= paperColumnStart &&
                  garbage[i].x + garbageSize <= paperColumnEnd &&
                  garbage[i].type == paper) ||
                (garbage[i].x >= comingledColumnStart &&
                  garbage[i].x + garbageSize <= comingledColumnEnd &&
                  garbage[i].type == comingled) ||
                (garbage[i].x >= organicsColumnStart &&
                  garbage[i].x + garbageSize <= organicsColumnEnd &&
                  garbage[i].type == organics) ||
                (garbage[i].x >= landfillColumnStart &&
                  garbage[i].x + garbageSize <= landfillColumnEnd &&
                  garbage[i].type == landfill)
              ) {
                if (garbage[i].falling) {
                  garbage[i].y += fallSpeed;
                }
              }

              garbage[i].falling = true;
            }
          }
        } else if (currentState == state.END) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          drawEndGameScreen();

          changeRestartAndHomeButtonSize();
        }
        ctx.drawImage(helpButton.image, helpButton.x, helpButton.y, helpButton.size, helpButton.size);
        requestAnimationFrame(draw);
      }
      loadAssets();
      drawHelpPanel();
      draw();
    </script>
  </body>
</html>
